#if defined(A25_1A)

      MODULE PHOT_MOD
! *****************************COPYRIGHT*******************************
! (C) Crown copyright Met Office. All rights reserved.
! For further details please refer to the file COPYRIGHT.txt
! which you should have received as part of this distribution.
! *****************************COPYRIGHT*******************************
      USE IN_STOCHEM_GRD
      USE IN_STOCHEM_CHM

      IMPLICIT NONE

      PRIVATE

      INTERFACE PHOT
        MODULE PROCEDURE PHOT
      END INTERFACE ! PHOT

      PUBLIC PHOT

!kk   Declaration Section
!kk   Module data moved from inside the subroutine to here

      INTEGER, PARAMETER :: nlam = 106

      REAL, DIMENSION(nlam) :: rayleigh =                               &
     &  (/353.0,336.0,320.0,305.0,290.0,276.0,262.0,249.0,236.0,224.0,  &
     &    213.0,202.0,192.0,182.0,172.0,163.0,154.0,146.0,138.0,131.0,  &
     &    123.0,117.0,110.0,104.0, 97.8, 92.2, 86.8, 81.7, 76.8, 72.2,  &
     &    67.8, 63.6, 59.7, 55.9, 52.4, 49.0, 45.8, 42.8, 40.1, 37.5,   &
     &    35.2, 33.1, 31.1, 29.2, 27.5, 26.0, 24.5, 23.1, 21.9, 20.7,   &
     &    19.6, 18.6, 17.6, 16.7, 15.9, 15.1, 14.4, 13.7, 13.0, 12.4,   &
     &    11.8, 11.3, 10.8, 10.3, 9.85, 9.42, 9.01, 8.63, 8.26, 7.92,   &
     &    7.59, 7.28, 6.99, 6.71, 6.44, 6.19, 5.95, 5.72, 5.50, 5.30,   &
     &    5.10, 4.91, 4.73, 4.56, 4.34, 4.18, 4.04, 3.90, 3.76, 3.63,   &
     &    3.51, 3.39, 3.28, 3.17, 3.06, 2.96, 2.87, 2.77, 2.68, 2.60,   &
     &    2.52, 2.44, 2.36, 2.29, 2.22, 2.15/)*1.0E-27

      REAL :: aeratt = 0.01/1.97e+7, aerscat= 0.09/1.97e+7

      REAL, DIMENSION(21) :: wlo1d =                                    &
     & (/305.0,306.0,307.0,308.0,309.0,310.0,311.0,312.0,313.0,314.0,   &
     &   315.0,316.0,317.0,318.0,319.0,320.0,321.0,322.0,323.0,324.0,   &
     &   325.0/),                                                       &
     &  alamb=                                                          &
     & (/ 1.01, 1.01, 1.05, 1.15, 1.39, 1.90, 2.93, 4.87, 8.21,13.30,   &
     &   17.60,20.40,18.00,21.80,18.10,17.20, 7.99,11.50,14.30,10.70,   &
     &   11.80/),                                                       &
     &  blamb=                                                          &
     & (/   3.933,  11.510,  33.090,  79.390, 159.900,                  &
     &    272.500, 407.900, 551.400, 682.300, 791.600,                  &
     &    851.300, 903.800, 900.300, 948.400, 891.100,                  &
     &   1066.000, 969.400,1201.000,1182.000,1152.000,                  &
     &   1435.000/),                                                    &
     &  asco1d=                                                         &
     & (/0.98890,0.99435,0.97994,0.98618,1.03851,                       &
     &   1.17710,0.94908,0.89159,0.86040,0.81783,                       &
     &   0.81410,0.85109,0.89691,0.86712,0.72665,                       &
     &   0.98637,0.97508,1.14312,0.94352,0.87827,                       &
     &   1.13719/)

      REAL, PARAMETER :: boltz = rmol / (100.0*na*h_planck*c_light)

      REAL, DIMENSION(nlam):: sgo2=                                     &
     & (/ 7.69,7.53,7.32,7.00,6.50,6.12,5.74,5.30,4.60,4.26,3.79,       &
     &    3.21,2.69,2.22,1.79,1.38,1.05,0.75,0.0 ,0.0 ,0.0 ,0.0 ,       &
     &    0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,       &
     &    0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,       &
     &    0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,       &
     &    0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,       &
     &    0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,       &
     &    0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,       &
     &    0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,       &
     &    0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0/)*1E-24
      REAL, DIMENSION(NLAM):: SGAO3=                                    &
     &  (/31.4  ,32.6  ,36.4  ,43.4  ,54.2  ,69.9  ,92.1  ,119.0 ,      &
     &    155.0 ,199.0 ,256.0 ,323.0 ,400.0 ,483.0 ,579.0 ,686.0 ,      &
     &    797.0 ,900.0 ,1000.0,1080.0,1130.0,1150.0,1120.0,1060.0,      &
     &    965.0 ,834.0 ,692.0 ,542.0 ,402.0 ,277.0 ,179.0 ,109.0 ,      &
     &    62.4  ,34.3  ,18.5  ,9.80  ,5.01  ,2.49  ,1.20  ,0.617 ,      &
     &    0.274 ,0.117 ,0.0588,0.0266,0.0109,0.0055,0.0   ,0.0   ,      &
     &    0.0   ,0.0   ,0.0   ,0.0   ,0.0   ,0.0   ,0.0   ,0.0029,      &
     &    0.0031,0.0040,0.0065,0.0068,0.0087,0.0125,0.0149,0.0171,      &
     &    0.0212,0.0357,0.0368,0.0406,0.0489,0.0711,0.0843,0.0828,      &
     &    0.0909,0.122 ,0.162 ,0.158 ,0.160 ,0.178 ,0.207 ,0.255 ,      &
     &    0.274 ,0.288 ,0.307 ,0.317 ,0.336 ,0.388 ,0.431 ,0.467 ,      &
     &    0.475 ,0.455 ,0.435 ,0.442 ,0.461 ,0.489 ,0.484 ,0.454 ,      &
     &    0.424 ,0.390 ,0.360 ,0.434 ,0.317 ,0.274 ,0.261 ,0.242 ,      &
     &    0.220 ,0.202/)*1E-20

! VALUES AT 273K
! JPL (1992)/IUPAC (1992), BASED LARGELY ON WMO (1986)
!
      REAL, DIMENSION(NLAM):: SGBO3=                                    &
     &  (/31.4  ,32.6  ,36.4  ,43.4  ,54.2  ,69.9  ,92.1  ,119.0 ,      &
     &    155.0 ,199.0 ,256.0 ,323.0 ,400.0 ,483.0 ,579.0 ,686.0 ,      &
     &    797.0 ,900.0 ,1000.0,1080.0,1130.0,1150.0,1120.0,1060.0,      &
     &    959.0 ,831.0 ,689.0 ,535.0 ,391.0 ,267.0 ,173.0 ,104.0 ,      &
     &    58.5  ,31.6  ,16.6  ,8.67  ,4.33  ,2.09  ,0.937 ,0.471 ,      &
     &    0.198 ,0.0777,0.0   ,0.0   ,0.0   ,0.0   ,0.0   ,0.0   ,      &
     &    0.0   ,0.0   ,0.0   ,0.0   ,0.0   ,0.0   ,0.0   ,0.0029,      &
     &    0.0031,0.0040,0.0065,0.0068,0.0087,0.0125,0.0149,0.0171,      &
     &    0.0212,0.0357,0.0368,0.0406,0.0489,0.0711,0.0843,0.0828,      &
     &    0.0909,0.122 ,0.162 ,0.158 ,0.160 ,0.178 ,0.207 ,0.255 ,      &
     &    0.274 ,0.288 ,0.307 ,0.317 ,0.336 ,0.388 ,0.431 ,0.467 ,      &
     &    0.475 ,0.455 ,0.435 ,0.442 ,0.461 ,0.489 ,0.484 ,0.454 ,      &
     &    0.424 ,0.390 ,0.360 ,0.434 ,0.317 ,0.274 ,0.261 ,0.242 ,      &
     &    0.220 ,0.202/)*1E-20

! VALUES AT 203K ;
! JPL (1992)/IUPAC (1992), BASED LARGELY ON WMO (1986) ;
      REAL, DIMENSION(NLAM):: SGANO2=                                   &
     &  (/41.5 ,41.5 ,44.8 ,44.5 ,46.4 ,48.7 ,48.2 ,50.2 ,44.4 ,47.1 ,  &
     &    37.7 ,39.3 ,27.4 ,27.8 ,16.9 ,16.2 , 8.81, 7.47, 3.91, 2.75,  &
     &    2.01, 1.97, 2.11, 2.36, 2.70, 3.25, 3.79, 5.03, 5.88, 7.00,   &
     &    8.15, 9.72,11.54,13.44,15.89,18.67,21.53,24.77,28.07,31.33,   &
     &    34.25,37.98,40.65,43.13,47.17,48.33,51.66,53.15,55.08,56.44,  &
     &    57.57,59.27,58.45,60.21,57.81,59.99,56.51,58.12, 0.0 , 0.0 ,  &
     &    0.0 , 0.0 , 0.0 , 0.0 , 0.0 , 0.0 , 0.0 , 0.0 , 0.0 , 0.0 ,   &
     &    0.0 , 0.0 , 0.0 , 0.0 , 0.0 , 0.0 , 0.0 , 0.0 , 0.0 , 0.0 ,   &
     &    0.0 , 0.0 , 0.0 , 0.0 , 0.0 , 0.0 , 0.0 , 0.0 , 0.0 , 0.0 ,   &
     &    0.0 , 0.0 , 0.0 , 0.0 , 0.0 , 0.0 , 0.0 , 0.0 , 0.0 , 0.0 ,   &
     &    0.0 , 0.0 , 0.0 , 0.0 , 0.0 , 0.0 /)*1.0E-20

! VALUES AT 273 K ;
! JPL (1992) ;
      REAL, DIMENSION(NLAM):: SGTNO2=                                   &
     & (/ 0.0  , 0.0  , 0.0  , 0.0  , 0.0  , 0.0  , 0.0  , 0.0  ,       &
     &    0.0  , 0.0  , 0.0  , 0.0  , 0.0  , 0.0  , 0.0  , 0.0  ,       &
     &    0.0  , 0.0  , 0.0  , 0.0  , 0.0  , 0.0  , 0.0  , 0.0  ,       &
     &    0.0  , 0.0  , 0.017, 0.075, 0.082,-0.053,-0.043,-0.031,       &
     &    -0.162,-0.284,-0.357,-0.536,-0.686,-0.786,-1.105,-1.355,      &
     &    -1.277,-1.612,-1.890,-1.219,-1.921,-1.095,-1.322,-1.102,      &
     &    -0.806,-0.867,-0.945,-0.923,-0.738,-0.599,-0.545,-1.129,      &
     &    0.001,-1.208, 0.0  , 0.0  , 0.0  , 0.0  , 0.0  , 0.0  ,       &
     &    0.0  , 0.0  , 0.0  , 0.0  , 0.0  , 0.0  , 0.0  , 0.0  ,       &
     &    0.0  , 0.0  , 0.0  , 0.0  , 0.0  , 0.0  , 0.0  , 0.0  ,       &
     &    0.0  , 0.0  , 0.0  , 0.0  , 0.0  , 0.0  , 0.0  , 0.0  ,       &
     &    0.0  , 0.0  , 0.0  , 0.0  , 0.0  , 0.0  , 0.0  , 0.0  ,       &
     &    0.0  , 0.0  , 0.0  , 0.0  , 0.0  , 0.0  , 0.0  , 0.0  ,       &
     &    0.0  , 0.0  /)*1.0E-22

! THIS IS THE TEMPERATURE DEPENDANCE IN 1.0E-22 CM**2 DEGREE-1
! JPL (1992) ;
!
      REAL, DIMENSION(NLAM):: SGNO3=                                    &
     & (/ 0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,    &
     &    0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,    &
     &    0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,    &
     &    0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,    &
     &    0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,    &
     &    0.0,  0.0,  0.0,  0.4,  2.8,  4.4,  5.4,  8.2, 10.4, 13.0,    &
     &    18.4, 19.4, 22.4, 28.4, 33.4, 37.2, 43.4, 51.0, 60.4, 64.4,   &
     &    68.6, 88.0, 96.8, 98.8,109.8,132.0,140.0,144.6,148.4,194.0,   &
     &    204.4,183.2,180.8,235.6,268.0,307.2,253.4,254.4,273.8,305.2,  &
     &    276.8,513.8,408.0,283.4,345.4,147.8,196.2,358.2,925.0,565.8,  &
     &    144.8,110.8,62.4,37.8,76.0,735.8/)*1E-20
      REAL, DIMENSION(NLAM) :: SGAHNO3=                                 &
     &  (/516.8,384.5,273.0,183.8,118.8,74.0,                           &
     &    44.96,28.18,18.51,13.35,10.19,8.02,6.51,5.21,4.17,3.21,       &
     &    2.66,2.30,2.09,1.99,1.96,1.95,1.93,1.88,1.80,1.68,            &
     &    1.52,1.34,1.13,0.924,0.720,0.533,0.371,0.242,0.144,0.081,     &
     &    0.042,0.020,0.010,0.004,0.002,0.001,0.001,0.0,0.0,0.0,        &
     &    0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,              &
     &    0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,              &
     &    0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,              &
     &    0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,              &
     &    0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0/)*1.0E-20

!kk delete SGN2O5

! BURKHOLDER ET AL (1993)/RATTIGAN ET AL (1992)
!
      REAL, DIMENSION(NLAM) :: SGTHNO3=                                 &
     &  (/1.675,1.716,1.757,1.820,1.936,2.061,                          &
     &    2.166,2.174,2.192,2.105,1.986,1.840,1.786,1.837,1.899,1.970,  &
     &    1.970,1.852,1.651,1.417,1.253,1.164,1.121,1.140,1.198,1.297,  &
     &    1.494,1.635,1.768,1.930,2.138,2.379,2.734,3.154,3.690,4.253,  &
     &    5.200,6.450,7.355,9.750,10.05,11.80,10.70,0.0,0.0,0.0,        &
     &    0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,              &
     &    0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,              &
     &    0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,              &
     &    0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,              &
     &    0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0/)*1E-03
! BURKHOLDER ET AL (1993)
!
      REAL, DIMENSION(NLAM) :: SGAHCHO=                                 &
     &  (/0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,  &
     &    0.0 ,0.0 ,0.02,0.02,0.03,0.09,0.12,0.18,0.24,0.35,0.41,0.62,  &
     &    0.59,1.11,1.26,1.46,2.00,2.18,2.41,2.10,3.63,2.83,2.79,2.44,  &
     &    2.49,1.80,2.09,2.04,1.22,1.42,0.58,0.48,0.48,0.06,0.0 ,0.0 ,  &
     &    0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,  &
     &    0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,  &
     &    0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,  &
     &    0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,  &
     &    0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0/)*1E-20
! VALUES AT 293K
! JPL (1992) AVERAGED
!
      REAL, DIMENSION(NLAM) :: SGBHCHO=                                 &
     &  (/0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,  &
     &    0.0 ,0.0 ,0.04,0.05,0.08,0.09,0.12,0.18,0.24,0.35,0.41,0.62,  &
     &    0.59,1.11,1.26,1.46,2.00,2.18,2.41,2.10,3.63,2.94,2.90,2.49,  &
     &    2.53,1.86,2.30,2.25,1.40,1.59,0.57,0.51,0.51,0.02,0.0 ,0.0 ,  &
     &    0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,  &
     &    0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,  &
     &    0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,  &
     &    0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,  &
     &    0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0/)*1E-20
! VALUES AT 223K
! JPL (1992) AVERAGED
!
      REAL, DIMENSION(NLAM) :: SGAH2O2=                                 &
     &  (/48.00,43.01,41.50,39.17,35.50,34.85,30.00,30.00,25.71,25.50,  &
     &    21.95,21.50,18.40,18.03,15.00,14.41,12.20,11.10, 9.90, 8.36,  &
     &    7.66, 6.40, 5.51, 4.87, 4.00, 3.30, 2.81, 2.34, 1.84, 1.48,   &
     &    1.23,0.986,0.750,0.562,0.420,0.308,0.223,0.160,0.115,0.082,   &
     &    0.060,0.043,0.031,0.022,0.015,0.010,0.006,0.003,0.0  ,0.0  ,  &
     &    0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,  &
     &    0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,  &
     &    0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,  &
     &    0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,  &
     &    0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,  &
     &    0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  /)*1E-20
! NICOVICH AND WINE (1988) ;
!
      REAL, DIMENSION(NLAM) :: SGBH2O2=                                 &
     &  (/25.0 ,25.0 ,25.0 ,25.0 ,25.0 ,25.0 ,25.0 ,25.0 ,25.0 ,25.0 ,  &
     &    25.0 ,25.0 ,25.0 ,25.0 ,25.0 ,25.0 ,25.0 ,24.95,24.90,24.49,  &
     &    24.17,23.30,22.09,21.00,18.90,17.21,15.84,14.46,12.70,11.26,  &
     &    10.08, 8.92, 7.77, 6.73, 5.81, 4.93, 4.13, 3.43, 2.83, 2.30,  &
     &    1.84, 1.40, 1.05, 0.80, 0.57, 0.40, 0.27, 0.16, 0.0 , 0.0 ,   &
     &    0.0 , 0.0 , 0.0 , 0.0 , 0.0 , 0.0 , 0.0 , 0.0 , 0.0 , 0.0 ,   &
     &    0.0 , 0.0 , 0.0 , 0.0 , 0.0 , 0.0 , 0.0 , 0.0 , 0.0 , 0.0 ,   &
     &    0.0 , 0.0 , 0.0 , 0.0 , 0.0 , 0.0 , 0.0 , 0.0 , 0.0 , 0.0 ,   &
     &    0.0 , 0.0 , 0.0 , 0.0 , 0.0 , 0.0 , 0.0 , 0.0 , 0.0 , 0.0 ,   &
     &    0.0 , 0.0 , 0.0 , 0.0 , 0.0 , 0.0 , 0.0 , 0.0 , 0.0 , 0.0 ,   &
     &    0.0 , 0.0 , 0.0 , 0.0 , 0.0 , 0.0 /)*1E-20
! NICOVICH AND WINE (1988) ;
!
      REAL, DIMENSION(NLAM) :: SGCH3OOH=                                &
     &  (/36.11,33.19,32.31,30.84,28.51,27.81,23.15,19.56,16.96,14.76,  &
     &    13.18,11.69,10.35, 9.13, 8.04, 7.08, 6.20, 5.48, 4.81, 4.26,  &
     &     3.74, 3.26, 2.82, 2.43, 2.12, 1.83, 1.57, 1.34, 1.11,0.922,  &
     &    0.767,0.635,0.515,0.398,0.308,0.238,0.182,0.137,0.105,0.079,  &
     &    0.061,0.047,0.035,0.027,0.021,0.016,0.012,0.0  ,0.0  ,0.0  ,  &
     &    0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,  &
     &    0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,  &
     &    0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,  &
     &    0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,  &
     &    0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,  &
     &    0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  /)*1E-20
! JPL (1992)
!
      REAL, DIMENSION(NLAM) :: SGACET=                                  &
     &  (/0.06 ,0.06 ,0.05 ,0.05 ,0.05 ,0.05 ,0.05 ,0.05 ,0.05 ,0.06 ,  &
     &    0.08 ,0.10 ,0.13 ,0.18 ,0.24 ,0.33 ,0.45 ,0.59 ,0.78 ,1.01 ,  &
     &    1.28 ,1.62 ,2.00 ,2.38 ,2.88 ,3.28 ,3.74 ,4.11 ,4.46 ,4.65 ,  &
     &    4.69 ,4.68 ,4.28 ,4.03 ,3.42 ,2.91 ,2.20 ,1.723,1.136,0.688,  &
     &    0.350,0.150,0.021,0.008,0.004,0.003,0.0  ,0.0  ,0.0  ,0.0  ,  &
     &    0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,  &
     &    0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,  &
     &    0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,  &
     &    0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,  &
     &    0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,  &
     &    0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  /)*1E-20
! MARTINEZ ET AL. (1992)
!
      REAL, DIMENSION(NLAM) :: SGAONE=                                  &
     &  (/0.61 ,0.43 ,0.21 ,0.12 ,0.11 ,0.11 ,0.12 ,0.14 ,0.17 ,0.22 ,  &
     &    0.29 ,0.36 ,0.47 ,0.61 ,0.77 ,0.98 ,1.24 ,1.53 ,1.88 ,2.27 ,  &
     &    2.70 ,3.15 ,3.62 ,4.08 ,4.46 ,4.78 ,4.99 ,5.06 ,5.05 ,4.79 ,  &
     &    4.43 ,3.94 ,3.30 ,2.69 ,2.05 ,1.40 ,0.858,0.467,0.205,0.067,  &
     &    0.017,0.005,0.002,0.001,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,  &
     &    0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,  &
     &    0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,  &
     &    0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,  &
     &    0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,  &
     &    0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,  &
     &    0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  /)*1E-20

! MARTINEZ ET AL. (1992)
!
      REAL, DIMENSION(NLAM) :: SGGLY=                                   &
     & (/ 0.0 , 0.0 , 0.0 , 0.0 , 0.0 , 0.0 , 0.0 , 0.0 , 0.0 , 0.0 ,   &
     &    0.0 , 0.0 , 0.0 , 0.0 , 0.0 , 0.0 , 0.0 , 0.0 , 0.0 , 0.0 ,   &
     &    0.0 , 0.0 , 0.0 , 0.0 , 0.0 , 0.0 , 0.0 , 0.0 , 2.87, 3.21,   &
     &    3.22, 3.21, 3.36, 3.48, 2.72, 2.72, 2.29, 1.43, 1.29, 1.15,   &
     &    2.87, 0.0 , 0.0 , 0.0 , 0.0 , 0.23, 0.29, 0.80, 1.00, 1.67,   &
     &    1.49, 3.03, 2.59, 3.36, 3.69, 4.50, 6.46, 5.31, 9.20, 6.93,   &
     &    5.90,11.71, 7.17, 7.53,20.38, 0.51, 0.0 , 0.0 , 0.0 , 0.0 ,   &
     &    0.0 , 0.0 , 0.0 , 0.0 , 0.0 , 0.0 , 0.0 , 0.0 , 0.0 , 0.0 ,   &
     &    0.0 , 0.0 , 0.0 , 0.0 , 0.0 , 0.0 , 0.0 , 0.0 , 0.0 , 0.0 ,   &
     &    0.0 , 0.0 , 0.0 , 0.0 , 0.0 , 0.0 , 0.0 , 0.0 , 0.0 , 0.0 ,   &
     &    0.0 , 0.0 , 0.0 , 0.0 , 0.0 , 0.0 /)*1E-20
!
      REAL, DIMENSION(NLAM) :: SGMGLY=                                  &
     &  (/0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,  &
     &    0.0  ,1.31 ,1.42 ,1.56 ,1.73 ,1.89 ,2.05 ,2.28 ,2.33 ,2.52 ,  &
     &    2.69 ,2.85 ,3.12 ,3.38 ,3.61 ,3.99 ,4.27 ,4.49 ,4.85 ,4.76 ,  &
     &    4.78 ,4.65 ,4.20 ,3.69 ,3.29 ,2.36 ,1.89 ,1.51 ,0.94 ,0.65 ,  &
     &    0.48 ,0.32 ,0.30 ,0.39 ,0.56 ,0.70 ,1.08 ,1.48 ,1.91 ,2.43 ,  &
     &    3.22 ,4.03 ,4.73 ,5.66 ,6.92 ,8.46 ,9.68 ,10.21,10.34,10.41,  &
     &    10.81,9.94 ,9.61 ,8.67 ,3.69 ,0.91 ,0.27 ,0.108,0.062,0.0  ,  &
     &    0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,  &
     &    0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,  &
     &    0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,  &
     &    0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  /)*1E-20
!  REF REQUIRED
!
      REAL, DIMENSION(NLAM) :: SGHO2NO2=                                &
     &  (/563.0,412.6,367.0,318.1,241.0,231.9,164.0,164.0,122.0,120.0,  &
     &    97.96,95.20,82.05,80.56,69.80,67.53,59.10,54.61,49.70,43.30,  &
     &    40.39,35.10,30.19,26.76,22.4 ,18.9 ,16.0 ,13.1 , 9.3 , 6.9 ,  &
     &    5.0 , 3.5 , 2.4 , 1.5 , 1.1 , 0.7 , 0.4 , 0.3 , 0.2 , 0.1 ,   &
     &    0.0 , 0.0 , 0.0 , 0.0 , 0.0 , 0.0 , 0.0 , 0.0 , 0.0 , 0.0 ,   &
     &    0.0 , 0.0 , 0.0 , 0.0 , 0.0 , 0.0 , 0.0 , 0.0 , 0.0 , 0.0 ,   &
     &    0.0 , 0.0 , 0.0 , 0.0 , 0.0 , 0.0 , 0.0 , 0.0 , 0.0 , 0.0 ,   &
     &    0.0 , 0.0 , 0.0 , 0.0 , 0.0 , 0.0 , 0.0 , 0.0 , 0.0 , 0.0 ,   &
     &    0.0 , 0.0 , 0.0 , 0.0 , 0.0 , 0.0 , 0.0 , 0.0 , 0.0 , 0.0 ,   &
     &    0.0 , 0.0 , 0.0 , 0.0 , 0.0 , 0.0 , 0.0 , 0.0 , 0.0 , 0.0 ,   &
     &    0.0 , 0.0 , 0.0 , 0.0 , 0.0 , 0.0 /)*1E-20
!  REF REQUIRED
!
      REAL, DIMENSION(NLAM) :: SGAPAN=                                  &
     &  (/342.8,307.7,274.4,239.0,204.6,173.0,144.1,120.0,99.81,83.69,  &
     &    70.27,59.32,50.20,42.50,35.68,30.18,25.22,20.91,17.25,14.21,  &
     &    11.71,9.551,7.764,6.241,4.915,3.806,2.844,2.094,1.497,1.040,  &
     &    0.665,0.448,0.289,0.175,0.108,0.066,0.041,0.025,0.015,0.011,  &
     &    0.006,0.005,0.002,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,  &
     &    0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,  &
     &    0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,  &
     &    0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,  &
     &    0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,  &
     &    0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,  &
     &    0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  /)*1E-20
!  TENDULKAR et al.(1995), values at 298 K.
!
      REAL, DIMENSION(NLAM) :: SGTPAN=                                  &
     &  (/1.213,0.960,0.798,0.725,0.739,0.824,0.964,1.139,1.343,1.555,  &
     &    1.765,1.980,2.186,2.398,2.624,2.856,3.075,3.280,3.481,3.667,  &
     &    3.847,4.027,4.236,4.489,4.744,5.010,5.353,5.747,6.171,6.634,  &
     &    7.123,7.628,8.110,8.505,8.835,9.138,9.515,10.00,10.50,10.90,  &
     &    11.60,12.20,12.50, 0.0 , 0.0 , 0.0 , 0.0 , 0.0 , 0.0 , 0.0 ,  &
     &    0.0 , 0.0 , 0.0 , 0.0 , 0.0 , 0.0 , 0.0 , 0.0 , 0.0 , 0.0 ,   &
     &    0.0 , 0.0 , 0.0 , 0.0 , 0.0 , 0.0 , 0.0 , 0.0 , 0.0 , 0.0 ,   &
     &    0.0 , 0.0 , 0.0 , 0.0 , 0.0 , 0.0 , 0.0 , 0.0 , 0.0 , 0.0 ,   &
     &    0.0 , 0.0 , 0.0 , 0.0 , 0.0 , 0.0 , 0.0 , 0.0 , 0.0 , 0.0 ,   &
     &    0.0 , 0.0 , 0.0 , 0.0 , 0.0 , 0.0 , 0.0 , 0.0 , 0.0 , 0.0 ,   &
     &    0.0 , 0.0 , 0.0 , 0.0 , 0.0 , 0.0 /)*1E-03
!  TENDULKAR et al.(1995), temperature dependance.
!

!
! ********************************************************************
!
!
! JPL (1992). ELEMENTS 0,1 AND 17 ARE 0.96,0.96 AND 0.81 OF WMO (1986) ;
!
!
! QUANTUM YIELDS (VALUES FOR OZONE ARE SET LATER )
!
      REAL, DIMENSION(NLAM) :: PNO2=                                    &
     &  (/1.000,1.000,1.000,1.000,1.000,1.000,1.000,1.000,1.000,1.000,  &
     &    1.000,1.000,1.000,1.000,1.000,1.000,1.000,1.000,1.000,1.000,  &
     &    1.000,1.000,1.000,1.000,1.000,1.000,1.000,1.000,1.000,1.000,  &
     &    1.000,0.999,0.998,0.997,0.996,0.995,0.994,0.993,0.992,0.991,  &
     &    0.990,0.989,0.988,0.987,0.986,0.984,0.983,0.981,0.979,0.975,  &
     &    0.969,0.960,0.927,0.694,0.355,0.134,0.060,0.018,0.001,0.0  ,  &
     &    0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,  &
     &    0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,  &
     &    0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,  &
     &    0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,  &
     &    0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0/)
!
      REAL, DIMENSION(NLAM) :: P1NO3=                                   &
     &  (/0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,  &
     &    0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,  &
     &    0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,  &
     &    0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,  &
     &    0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,  &
     &    0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,  &
     &    0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,  &
     &    0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,  &
     &    0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,  &
     &    0.10 ,0.25 ,0.40 ,0.45 ,0.35 ,0.25 ,0.15 ,0.10 ,0.075,0.05 ,  &
     &    0.025,0.0  ,0.0  ,0.0  ,0.0  ,0.0/)
!
      REAL, DIMENSION(NLAM) :: P2NO3=                                   &
     &  (/0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,  &
     &    0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,  &
     &    0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,  &
     &    0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,  &
     &    0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,  &
     &    0.0  ,0.0  ,0.0  ,1.000,1.000,1.000,1.000,1.000,1.000,1.000,  &
     &    1.000,1.000,1.000,1.000,1.000,1.000,1.000,1.000,1.000,1.000,  &
     &    1.000,1.000,1.000,1.000,1.000,1.000,1.000,1.000,1.000,1.000,  &
     &    1.000,1.000,1.000,1.000,1.000,1.000,1.000,1.000,1.000,1.000,  &
     &    0.90 ,0.75 ,0.60 ,0.50 ,0.40 ,0.30 ,0.25 ,0.15 ,0.10 ,0.05 ,  &
     &    0.00 ,0.0  ,0.0  ,0.0  ,0.0  ,0.0/)
!
      REAL, DIMENSION(NLAM) :: P1N2O5=                                  &
     &  (/0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.01,0.01,0.02,0.02,  &
     &    0.05,0.05,0.09,0.10,0.14,0.17,0.21,0.33,0.38,0.47,0.54,0.58,  &
     &    0.63,0.67,0.70,0.72,0.74,0.76,0.78,0.89,1.0 ,1.0 ,1.0 ,1.0 ,  &
     &    1.0 ,1.0 ,1.0 ,1.0 ,1.0 ,1.0 ,1.0 ,1.0 ,1.0 ,1.0 ,1.0 ,1.0 ,  &
     &    1.0 ,1.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,  &
     &    0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,  &
     &    0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,  &
     &    0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,  &
     &    0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0/)
!
      REAL, DIMENSION(NLAM) :: P1HCHO=                                  &
     &  (/0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,  &
     &    0.0 ,0.0 ,0.11,0.13,0.21,0.27,0.28,0.29,0.29,0.29,0.30,0.31,  &
     &    0.34,0.37,0.42,0.49,0.56,0.63,0.69,0.73,0.74,0.75,0.75,0.74,  &
     &    0.70,0.59,0.46,0.30,0.13,0.02,.001,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,  &
     &    0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,  &
     &    0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,  &
     &    0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,  &
     &    0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,  &
     &    0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0/)
!
      REAL, DIMENSION(NLAM) :: P2HCHO=                                  &
     &  (/0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,  &
     &    0.0 ,0.0 ,0.21,0.25,0.42,0.49,0.49,0.49,0.49,0.49,0.49,0.48,  &
     &    0.46,0.44,0.41,0.37,0.32,0.29,0.26,0.24,0.25,0.25,0.25,0.27,  &
     &    0.33,0.40,0.52,0.67,.921,.988,.999,1.0 ,1.0 ,1.0 ,0.0 ,0.0 ,  &
     &    0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,  &
     &    0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,  &
     &    0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,  &
     &    0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,  &
     &    0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0/)
!
      REAL, DIMENSION(NLAM) :: PP2HCHO=                                 &
     &  (/0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,  &
     &    0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,  &
     &    0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,  &
     &    0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,  &
     &    0.336,0.738,1.320,2.260,4.510,7.750,0.0  ,0.0  ,0.0  ,0.0  ,  &
     &    0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,  &
     &    0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,  &
     &    0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,  &
     &    0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,  &
     &    0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,  &
     &    0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0/)*1E-3
! P1HCHO AND P2HCHO FROM JPL (1992) ;
! PP2HCHO VALUES DERIVED FROM JPL (1992) 760 TORR, AND LOW P VALUES ;
! OF MOORTGAT ET AL (1983) ;
!
      REAL, DIMENSION(NLAM) :: P1ACET=                                  &
     &  (/0.36,0.36,0.36,0.36,0.36,0.36,0.36,0.36,0.36,0.36,0.36,0.36,  &
     &    0.36,0.36,0.36,0.36,0.36,0.36,0.36,0.36,0.36,0.36,0.36,0.38,  &
     &    0.50,0.55,0.60,0.66,0.76,0.82,0.86,0.90,0.92,0.93,0.94,0.94,  &
     &    0.90,0.48,0.25,0.10,0.04,0.01,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,  &
     &    0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,  &
     &    0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,  &
     &    0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,  &
     &    0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,  &
     &    0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0/)
!
      REAL, DIMENSION(NLAM) :: PP1ACET=                                 &
     &  (/0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,  &
     &    0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,  &
     &    0.57,0.60,0.52,0.41,0.42,0.61,0.78,1.01,1.28,1.59,2.09,3.30,  &
     &    5.65,4.80,6.91,6.00,3.80,2.50,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,  &
     &    0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,  &
     &    0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,  &
     &    0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,  &
     &    0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,  &
     &    0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0/)*1E-3
!
! P1ACET (LOW P) UNCHANGED ;
! PP1ACET VALUES MODIFIED TO GENERATE 760TORR P1ACET VALUES AS IUPAC
! (1992)
!
!
      REAL, DIMENSION(NLAM):: PAONE=                                    &
     &  (/0.70,0.70,0.70,0.70,0.70,0.70,0.70,0.70,0.70,0.70,0.70,0.70,  &
     &    0.70,0.70,0.70,0.70,0.70,0.70,0.70,0.70,0.77,0.79,0.80,0.80,  &
     &    0.78,0.70,0.61,0.57,0.55,0.50,0.39,0.29,0.21,0.14,0.10,0.05,  &
     &    0.03,0.03,0.03,0.03,0.03,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,  &
     &    0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,  &
     &    0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,  &
     &    0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,  &
     &    0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,  &
     &    0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0/)
! MEYRAHN ET AL (1986)
!
      REAL, DIMENSION(NLAM) :: P1GLY=                                   &
     &  (/0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,  &
     &    0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,  &
     &    0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,  &
     &    0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,  &
     &    0.0  ,0.0  ,0.0  ,0.0  ,.0252,.0252,.0252,.0252,.0252,.0252,  &
     &    .0252,.0252,.0252,.0252,.0252,.0252,.0252,.0252,.0252,.0252,  &
     &    .0252,.0252,.0252,.0252,.0252,.0252,0.0  ,0.0  ,0.0  ,0.0  ,  &
     &    0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,  &
     &    0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,  &
     &    0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,  &
     &    0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0/)
! BASED ON COMMENTS IN IUPAC (1992) ;
!
      REAL, DIMENSION(NLAM) :: PMGLY=                                   &
     &  (/0.11 ,0.11 ,0.11 ,0.11 ,0.11 ,0.11 ,0.11 ,0.11 ,0.11 ,0.11 ,  &
     &    0.11 ,0.11 ,0.11 ,0.11 ,0.11 ,0.11 ,0.11 ,0.11 ,0.11 ,0.11 ,  &
     &    0.11 ,0.11 ,0.11 ,0.11 ,0.11 ,0.11 ,0.11 ,0.11 ,0.11 ,0.11 ,  &
     &    0.11 ,0.11 ,0.11 ,0.11 ,0.11 ,0.11 ,0.11 ,0.11 ,0.11 ,0.11 ,  &
     &    0.11 ,0.11 ,0.11 ,0.11 ,0.11 ,0.11 ,0.11 ,0.11 ,0.11 ,0.11 ,  &
     &    0.045,0.045,0.045,0.045,0.045,0.045,0.045,0.045,0.045,0.045,  &
     &    0.045,0.045,0.045,0.045,0.045,0.045,0.045,0.045,0.045,0.0  ,  &
     &    0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,  &
     &    0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,  &
     &    0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,  &
     &    0.0  ,0.0  ,0.0  ,0.0  ,0.0  ,0.0/)
! PLUM ET AL (1983) AND TYNDALL (PRIV.COM.1993) ABOVE 380NM
! RABER AND MOORTGAT (1994) SCALED DATA BELOW 380NM

      REAL, DIMENSION(NLAM) :: LAMBDA=                                  &
     &  (/201.010 ,203.051 ,205.134 ,207.2595,209.4295,211.646 ,        &
     &    213.910 ,216.2225,218.5855,221.001 ,223.4705,225.996 ,        &
     &    228.579 ,231.2215,233.926 ,236.6945,239.5295,242.433 ,        &
     &    245.408 ,248.457 ,251.5825,254.7875,258.075 ,261.449 ,        &
     &    264.9125,268.4685,272.1215,275.8755,279.734 ,283.702 ,        &
     &    287.7845,291.9865,296.3125,300.7685,305.3610,310.0960,        &
     &    315.0   ,320.0   ,325.0   ,330.0   ,335.0   ,340.0   ,        &
     &    345.0   ,350.0   ,355.0   ,360.0   ,365.0   ,370.0   ,        &
     &    375.0   ,380.0   ,385.0   ,390.0   ,395.0   ,400.0   ,        &
     &    405.0   ,410.0   ,415.0   ,420.0   ,425.0   ,430.0   ,        &
     &    435.0   ,440.0   ,445.0   ,450.0   ,455.0   ,460.0   ,        &
     &    465.0   ,470.0   ,475.0   ,480.0   ,485.0   ,490.0   ,        &
     &    495.0   ,500.0   ,505.0   ,510.0   ,515.0   ,520.0   ,        &
     &    525.0   ,530.0   ,535.0   ,540.0   ,545.0   ,550.0   ,        &
     &    555.0   ,560.0   ,565.0   ,570.0   ,575.0   ,580.0   ,        &
     &    585.0   ,590.0   ,595.0   ,600.0   ,605.0   ,610.0   ,        &
     &    615.0   ,620.0   ,625.0   ,630.0   ,635.0   ,640.0   ,        &
     &    645.0   ,650.0   ,655.0   ,660.0/)

      CONTAINS
      SUBROUTINE PHOT(jlb,p,cloud_lb,o3col_lb,o3_lb,landfr_lb,          &
     &  snowfr_lb,seaicefr_lb,zenith_lb,time,pp_lb,tt_lb)
!----------------------------------------------------------------------
!-
!-   Purpose and Methods : CALCULATE PHOTOLYSIS RATES
!-
!
! Current Code Owner: Bill Collins
!
! History:
! Version   Date     Comment
! -------   ----     -------
!  3.4  01/02/94   Created  M.E. Jenkin
!  5.5  16/02/04   Modified for vectorisation on SX6. K. Ketelsen
!  6.1  07/09/04   Added '&' at end of lines for F90 compatability.
!                  M.G. Sanderson
!  6.2  31/01/06   Placed names of interface statement end blocks
!                  behind comments for portability. T. Edwards

!----------------------------------------------------------------------
      IMPLICIT NONE
!----------------------------------------------------------------------
! PHOTOL  SINGLE-COLUMN PHOTOLYSIS CODE, A.M. HOUGH (HARWELL LABORATORY)
!         FORTRAN CONVERSION OF FACSIMILE OLIVER WILD (UNIV. CAMBRIDGE)
!
! NEWPHOT REVISED CROSS-SECTIONS & QUANTUM YIELDS (FEB. 1994, M.E. JENKI
!         C.E. JOHNSON, HARWELL LABORATORY)
!
! NPP     THIS VERSION IN PRESSURE COORDINATES FOR CONVERSION TO
!         SUBROUTINE.  CEJ 23/II/94.
!         VER. 2 HAS 9 LAYERS.
!         VER. 3 HAS 9 CLOUD LAYERS.
!
! RADIATION TRANSFER AND PHOTOLYSIS RATE CALCULATIONS
! 200-660 NM.
!
! VERSION WITH TWO-STREAM SCATTER AND REFLECTION CALCULATIONS
! 'HALF' PARAMETERS REFER TO VALUES 25% UP THE BOTTOM LEVEL
!
! THE EFFECTS OF SCATTER ABOVE THE MODEL DOMAIN ARE IGNORED !!
!
! CLOUD AND AERO REFER TO FRACTIONAL CLOUD COVER AND TO THE AEROSOL
! CONCENTRATION CENTRED ON THE TOP OF THE MODEL LAYERS
! CLOUD MAY BE PRESENT AT THE TOP OF ANY MODEL LEVEL.
! LOW CLOUD IS ASSUMED TO OCCUPY LOWEST THREE LAYERS.
! MEDIUM CLOUD IS ASSUMED TO OCCUPY MIDDLE THREE LAYERS.
! HIGH CLOUD IS ASSUMED TO OCCUPY HIGHEST THREE LAYERS.
! THIS WILL NEED CHANGING IF NLEV IS CHANGED.
!
! NOTE THAT ATTENUATION AND SCATTER ARE CALCULATED ON THE BOUNDARIES
! BETWEEN THE DIFFERENT LEVELS, SO AS TO OBTAIN VALUES FOR THE FLUXES
! AND RATES AT THE CENTRE OF THE LEVELS.
!
! US STANDARD ATMOSPHERE OZONE COLUMN.
! * Replaced by O3 column from Li+Shine(+trend) climatology *
! O3COL IS THE OZONE COLUMN ABOVE model top hPa IN DOBSON UNITS.
! O2COL IS THE OXYGEN COLUMN ABOVE model top IN MOLECULES CM-2.
!
! FLUXES ARE FLUX<WLENGTH RANGE,SCATTERING ORDER,MODEL LEVEL>

! PHOTOABSORPTION CROSS-SECTIONS (UNITS OF 1.0E-20 CM**2)
! (N2O CROSS SECTIONS ARE CALCULATED IN THE CODE)

      INTEGER,INTENT(IN)                         :: jlb
      REAL, DIMENSION(:),INTENT(IN)              :: O3COL_lb,LANDFR_lb
      REAL, DIMENSION(:),INTENT(IN)              :: SNOWFR_lb
      REAL, DIMENSION(:),INTENT(IN)              :: SEAICEFR_lb
      REAL, DIMENSION(:),INTENT(IN)              :: ZENITH_lb
      REAL, DIMENSION(0:NLEV,jlb), INTENT(IN)    :: CLOUD_lb
      REAL, DIMENSION(NLEV,jlb), INTENT(IN)      :: O3_lb
      REAL, DIMENSION(0:NLEV,jlb), INTENT(IN)    :: PP_lb
      REAL, DIMENSION(0:NLEV,jlb), INTENT(IN)    :: TT_lb
      REAL                                       :: TIME
      REAL, DIMENSION(NDJ,jlb,NLEV), INTENT(OUT) :: P

      REAL                              :: O3COL
      REAL                              :: LANDFR,SEAICEFR,SNOWFR
      REAL                              :: ZENITH
      REAL, DIMENSION(0:NLEV)           :: CLOUD
      REAL, DIMENSION(NLEV)             :: O3
      REAL, DIMENSION(0:NLEV)           :: PP
      REAL, DIMENSION(0:NLEV)           :: TT

      INTEGER :: ii,J,m
      REAL, DIMENSION(NLEV,jlb) :: PU,TU
      REAL, DIMENSION(NLEV)     :: NU
      REAL, DIMENSION(0:NLEV)   :: NN,ZZ,DZ,O2N,OZONE,RI,AERO,CCOS
      REAL, DIMENSION(NLAM) :: ALB0SURF,ALB1SURF

      REAL, DIMENSION(jlb) :: J1O3,J2O3,JNO2,J1NO3,J2NO3,J1N2O5,        &
     &     JHNO3,J1HCHO,J2HCHO,JH2O2,JCH3OOH,J1ACET,                    &
     &     JAONE,J1GLY,JMGLY,JHO2NO2,JPAN
!
      REAL, DIMENSION(NLAM,jlb)      :: SGO3,SGNO2,SGHCHO,SGH2O2
      REAL, DIMENSION(NLAM,NLEV,jlb) :: P1O3


      REAL, DIMENSION(NLAM,jlb)    :: SGHNO3,SGPAN,SGN2O5
      REAL, DIMENSION(NLAM,0:NLEV) :: ATTA0,ATTA1,ATTS0,                &
     &     ATTS1,ALBC0,ALBC1,FRBK0,FRBK1,FRFD0,FRFD1,TRAC0,TRAC1
      REAL, DIMENSION(NLAM,0:NLEV,jlb)     :: FLUXTOT
      REAL, DIMENSION(NLAM,6,0:NLEV+1,jlb) :: FLUXDN,FLUXUP

      real,dimension(0:NLEV)   :: MM
      REAL :: MMTOP,SSEC,COSSURF,O2COL
      LOGICAL,save    :: FIRST=.TRUE.
      REAL, PARAMETER :: ASCAT=1.8508

      FLUXUP=0.
      FLUXDN=0.
      FLUXTOT=0.0

      do ii=1,jlb
        O3COL     = O3COL_lb(ii)
        CLOUD     = CLOUD_lb(:,ii)
        O3        = O3_lb(:,ii)
        LANDFR    = LANDFR_lb(ii)
        SNOWFR    = SNOWFR_lb(ii)
        SEAICEFR  = SEAICEFR_lb(ii)
        ZENITH    = ZENITH_lb(ii)
        PP        = PP_lb(:,ii)
        TT        = TT_lb(:,ii)

! Calculate O2 column in molecules/cm2
      O2COL=1.0E-4*PP(NLEV)*NA*O2FRAC/(G*MAIR)
      CALL INTHRI(TT,PP,PU(:,ii),TU(:,ii),NU,ZZ,DZ,RI,NN)

! Scale total aerosol column extinction by aerosol column density
      AERO=INIAER(ZZ)

      CALL INIO3(O3,NN,NU,OZONE,O2N)

! Write out initial conditions.
      IF(FIRST) THEN
        WRITE(6,'(A,                                                    &
     &    //A,F6.2,                                                     &
     &    //A,1PE12.2,                                                  &
     &    //A,1PE12.2,                                                  &
     &    //A,0PF6.2,A,F6.2,A,F6.2,                                     &
     &    //A,/20F6.2//)')                                              &
     &    ' SINGLE COLUMN PHOTOLYSIS PROGRAMME NPP3',                   &
     &    'ZENITH : ',ZENITH,                                           &
     &    ' O2 COLUMN ABOVE TOP (MOLECULES/CM^2) : ',O2COL,             &
     &    ' O3 COLUMN ABOVE TOP (DOBSON UNITS  ) : ',O3COL,             &
     &    ' LAND FRACTION : ',LANDFR,' OCEAN FRACTION : ',1.-LANDFR,    &
     &    ' ICE FRACTION : ',SEAICEFR,                                  &
     &    ' CLOUD FRACTION IN EACH LAYER : ',CLOUD
      ENDIF
        CALL MMCALC(ZENITH,MMTOP,SSEC)
        CALL CLOUDS(SSEC,RI,TRAC0,TRAC1,ALBC0,ALBC1)
        CALL SURALB(COSSURF,LANDFR,SEAICEFR,SNOWFR,ALB0SURF,ALB1SURF)
        FLUXDN(:,1,NLEV+1,ii)=INCFLX(O3COL*DOB*1E-4,TIME)

! Calculate the attenuation factors for absorption and scatter
        CCOS = SQRT(1.0-((SSEC/RI)**2))
        MM = 1.0/CCOS
        CALL ATTEN(ATTA0,ATTS0,FRBK0,FRFD0,TT,DZ,OZONE,MM,              &
     &      AERO,NN,ALBC0,CLOUD,TRAC0,O2N)
        MM = ASCAT
        CALL ATTEN(ATTA1,ATTS1,FRBK1,FRFD1,                             &
     &      TT,DZ,OZONE,MM,AERO,NN,ALBC1,                               &
     &      CLOUD,TRAC1,O2N)

! Calculation of the solar fluxes through the model domain
! including the 2cos(theta) factor which occurs in the actinic flux
! when a direct beam is scattered isotropically.
! o3col is climatological column above model top
! TDOB is not used any more.

        CALL CALFLX
        FIRST=.FALSE.
      end do

      call GETO3(TU,P1O3)

      DO J = 1,NLEV
        J1O3 = 0.0
        J2O3 = 0.0
        JNO2 = 0.0
        J1NO3 = 0.0
        J2NO3 = 0.0
        J1N2O5 = 0.0
        JHNO3 = 0.0
        J1HCHO = 0.0
        J2HCHO = 0.0
        JH2O2 = 0.0
        JCH3OOH = 0.0
        J1ACET = 0.0
        JAONE = 0.0
        J1GLY = 0.0
        JMGLY = 0.0
        JHO2NO2 = 0.0
        JPAN = 0.0

          CALL GETSIG(J,TU)
        do m=1,nlam
         do ii=1,jlb
          J1O3(ii)    = J1O3(ii)+(FLUXTOT(m,J,ii)*SGO3(m,ii)*           &
     &                                                P1O3(m,j,ii))
          J2O3(ii)    = J2O3(ii)+(FLUXTOT(m,J,ii)*                      &
     &                                  SGO3(m,ii)*(1.0-P1O3(m,j,ii)))
          JNO2(ii)    = JNO2(ii)+(FLUXTOT(m,J,ii)*SGNO2(m,ii)*PNO2(m))
          J1NO3(ii)   = J1NO3(ii)+(FLUXTOT(m,J,ii)*SGNO3(m)*P1NO3(m))
          J2NO3(ii)   = J2NO3(ii)+(FLUXTOT(m,J,ii)*SGNO3(m)*P2NO3(m))
          J1N2O5(ii)  = J1N2O5(ii)+(FLUXTOT(m,J,ii)*                    &
     &                                      SGN2O5(m,ii)*P1N2O5(m))
          JHNO3(ii)   = JHNO3(ii)+(FLUXTOT(m,J,ii)*SGHNO3(m,ii))
          J1HCHO(ii)  = J1HCHO(ii)+(FLUXTOT(m,J,ii)*                    &
     &                                      SGHCHO(m,ii)*P1HCHO(m))
          J2HCHO(ii)  = J2HCHO(ii)+(FLUXTOT(m,J,ii)*SGHCHO(m,ii)        &
     &      *(P2HCHO(m)/(1.0+(PU(J,ii)*PP2HCHO(m)))))
          JH2O2(ii)   = JH2O2(ii)+(FLUXTOT(m,J,ii)*SGH2O2(m,ii))
          JCH3OOH(ii) = JCH3OOH(ii)+(FLUXTOT(m,J,ii)*SGCH3OOH(m))
          J1ACET(ii)  = J1ACET(ii)+(FLUXTOT(m,J,ii)*SGACET(m)           &
     &      *(P1ACET(m)/(1.0+(PU(J,ii)*PP1ACET(m)))))
          JAONE(ii)   = JAONE(ii)+(FLUXTOT(m,J,ii)*SGAONE(m)*PAONE(m))
          J1GLY(ii)   = J1GLY(ii)+(FLUXTOT(m,J,ii)*SGGLY(m)*P1GLY(m))
          JMGLY(ii)   = JMGLY(ii)+(FLUXTOT(m,J,ii)*SGMGLY(m)*PMGLY(m))
          JHO2NO2(ii) = JHO2NO2(ii)+(FLUXTOT(m,J,ii)*SGHO2NO2(m))
          JPAN(ii)    = JPAN(ii)+(FLUXTOT(m,J,ii)*SGPAN(m,ii))
         END DO
        END DO

! Correct j2o3 to compensate for neglecting longer wavelengths.
        DO ii = 1, jlb
          J2O3(ii)    = J2O3(ii)+(10.0*FLUXTOT(106,J,ii)*SGO3(106,ii))
        END DO

        P(1,:,J)=J2O3
        P(2,:,J)=J1O3
        P(3,:,J)=JNO2
        P(4,:,J)=JH2O2
        P(5,:,J)=JHNO3
        P(6,:,J)=J1HCHO
        P(7,:,J)=J2HCHO
        P(8,:,J)=J1ACET
        P(9,:,J)=JAONE
        P(10,:,J)=JHO2NO2
        P(11,:,J)=JMGLY
        P(12,:,J)=J1GLY
        P(13,:,J)=J1NO3
        P(14,:,J)=J2NO3
        P(15,:,J)=J1N2O5
        P(16,:,J)=JCH3OOH
        P(17,:,J)=JPAN
      END DO

      CONTAINS
      SUBROUTINE ATTEN(atta,atts,frbk,frfd,tt,dz,ozone,mm,aero,nn,albc, &
     &  cloud,trac,o2n)
!----------------------------------------------------------------------
!-
!-   Purpose and Methods : Calculate attenuation factors for absorption
!-                         and scatter
!-
!-   Inputs  : SGAO3,SGBO3,SGO2,TT,DZ,OZONE,MM,AERATT,AERO,NN,RAYLEIGH,
!-             ALBC,CLOUD,TRAC,O2N,AERSCAT
!-   Outputs : ATTA,ATTS,FRBK,FRFD
!-   Controls:
!-
!
! Current Code Owner: Bill Collins
!
! History:
! Version   Date     Comment
! -------   ----     -------
!  3.4  06/06/94   Created  W.J. Collins
!  5.5  17/03/04   Modified for vectorisation on SX6. K. Ketelsen
!  6.1  07/09/04   Added '&' at end of lines for F90 compatability.
!                  M.G. Sanderson
!
!----------------------------------------------------------------------
      IMPLICIT NONE
!----------------------------------------------------------------------
      REAL, DIMENSION(NLAM,0:NLEV), INTENT(IN)  :: ALBC,TRAC
      REAL, DIMENSION(0:NLEV), INTENT(IN)       :: DZ,TT,OZONE,MM,AERO
      REAL, DIMENSION(0:NLEV), INTENT(IN)       :: CLOUD,O2N,NN
      REAL, DIMENSION(NLAM,0:NLEV), INTENT(OUT) :: ATTA,ATTS,FRBK,FRFD

      INTEGER :: j,k
      REAL    :: SGO3_lo, SCAT_lo
      REAL    :: AERATT = 0.01/1.97E+7, AERSCAT = 0.09/1.97E+7

      DO k=0,nlev
        DO j=1,nlam
          SGO3_lo = SGAO3(j)-(((SGAO3(j)-SGBO3(j))*(273.0-TT(k)))/70.0)
          ATTA(j,k) = EXP(-MM(k)*((OZONE(k)*SGO3_lo)+(O2N(k)*SGO2(j))+  &
     &      DZ(k)*(AERATT*AERO(k))))
          SCAT_lo   = EXP(-MM(k)*((NN(k)*RAYLEIGH(j))+                  &
     &      DZ(k)*(AERSCAT*AERO(k))))
          FRBK(j,k) = ((0.5*(1.0-SCAT_lo))+(ALBC(j,k)*CLOUD(k)))/       &
     &      ((1.0-SCAT_lo)+CLOUD(k))
          FRFD(j,k) = ((0.5*(1.0-SCAT_lo))+(TRAC(j,k)*CLOUD(k)))/       &
     &      ((1.0-SCAT_lo)+CLOUD(k))
          ATTS(j,k) = SCAT_lo*(1.0-CLOUD(k))
        END DO
      END DO

      END SUBROUTINE ATTEN
      SUBROUTINE CALFLX
!----------------------------------------------------------------------
!-
!-   Purpose and Methods : CALCULATE FLUXES
!-
!-   Inputs  : ATTA0,ATTS0,ATTA1,ATTS1,CCOS,COSSURF,ALB0SURF,ALB1SURF,
!-             FRBK0,FRFD0,FRBK1,FRFD1
!-   Outputs : FLUXDN,FLUXUP
!-   Controls:
!
! Current Code Owner: Bill Collins
!
! History:
! Version   Date     Comment
! -------   ----     -------
!  3.4  06/06/94   Created  W.J. Collins
!  5.5  17/03/04   Modified for vectorisation on SX6. Compute FLUXTOT
!                  here. K. Ketelsen
!  6.1  07/09/04   Added '&' at end of lines for F90 compatability.
!                  M.G. Sanderson
!-
!VVV  V2.2  CALFLX 20/X/99
!----------------------------------------------------------------------
      IMPLICIT NONE
!----------------------------------------------------------------------
!
      INTEGER :: m, i, j
      REAL :: ccos2
!
! THE DIRECT BEAM AND ITS REFLECTION AT THE SURFACE
!
!CDIR unroll=4
      DO J= NLEV,0,-1
        FLUXDN(:,1,J,ii) = FLUXDN(:,1,J+1,ii)*ATTA0(:,J)*ATTS0(:,J)
      END DO
      FLUXUP(:,1,0,ii) = FLUXDN(:,1,0,ii)*ALB0SURF*(2.0*COSSURF)
!CDIR unroll=4
      DO J=0,NLEV
        FLUXUP(:,1,J+1,ii) = FLUXUP(:,1,J,ii)*ATTA1(:,J)*ATTS1(:,J)
        FLUXTOT(:,J,ii)=FLUXTOT(:,J,ii)+                                &
     &                             (FLUXDN(:,1,J,ii)+FLUXUP(:,1,J,ii))
      END DO
!
! THE FIRST ORDER SCATTERED BEAM AND SURFACE REFLECTION
!
!CDIR unroll=4
      DO J=NLEV,0,-1
        CCOS2 = 2.0*CCOS(J)
        FLUXDN(:,2,J,ii) = FLUXDN(:,2,J+1,ii)*ATTA1(:,J)*ATTS1(:,J)     &
     &               + (FLUXDN(:,1,J+1,ii)*ATTA0(:,J)*FRFD0(:,J)        &
     &               * (1.0-ATTS0(:,J))*CCOS2)                          &
     &               + (FLUXUP(:,1,J,ii)  *ATTA1(:,J)*FRBK1(:,J)        &
     &               * (1.0-ATTS1(:,J)))
      END DO
      FLUXUP(:,2,0,ii) = FLUXDN(:,2,0,ii)*ALB1SURF
!CDIR unroll=4
      DO J=0,NLEV
        CCOS2 = 2.0*CCOS(J)
        FLUXUP(:,2,J+1,ii) = FLUXUP(:,2,J,ii)  *ATTA1(:,J)*ATTS1(:,J)   &
     &                 + (FLUXDN(:,1,J+1,ii)*ATTA0(:,J)*FRBK0(:,J)      &
     &                 * (1.0-ATTS0(:,J))*CCOS2)                        &
     &                 + (FLUXUP(:,1,J,ii)  *ATTA1(:,J)*FRFD1(:,J)      &
     &                 * (1.0-ATTS1(:,J)))
        FLUXTOT(:,J,ii)=FLUXTOT(:,J,ii)+                                &
     &                             (FLUXDN(:,2,J,ii)+FLUXUP(:,2,J,ii))
      END DO
!
! THE THIRD TO SIXTH ORDER SCATTERED BEAMS.
!
      DO I=3,6
!CDIR unroll=4
        DO J=NLEV,0,-1
          FLUXDN(:,I,J,ii) = FLUXDN(:,I,J+1,ii)  *ATTA1(:,J)*ATTS1(:,J) &
     &                 + (FLUXDN(:,I-1,J+1,ii)*ATTA1(:,J)*FRFD1(:,J)    &
     &                 * (1.0-ATTS1(:,J)))                              &
     &                 + (FLUXUP(:,I-1,J,ii)  *ATTA1(:,J)*FRBK1(:,J)    &
     &                 * (1.0-ATTS1(:,J)))
        END DO
        FLUXUP(:,I,0,ii) = FLUXDN(:,I,0,ii)*ALB1SURF
!CDIR unroll=4
        DO J=0,NLEV
          FLUXUP(:,I,J+1,ii) = FLUXUP(:,I,J,ii) *ATTA1(:,J)*ATTS1(:,J)  &
     &                   + (FLUXDN(:,I-1,J+1,ii)*ATTA1(:,J)*FRBK1(:,J)  &
     &                   * (1.0-ATTS1(:,J)))                            &
     &                   + (FLUXUP(:,I-1,J,ii)  *ATTA1(:,J)*FRFD1(:,J)  &
     &                   * (1.0-ATTS1(:,J)))
          FLUXTOT(:,J,ii)=FLUXTOT(:,J,ii)+                              &
     &                             (FLUXDN(:,I,J,ii)+FLUXUP(:,I,J,ii))
        END DO
      END DO

      END SUBROUTINE CALFLX
      SUBROUTINE CLOUDS(SSEC,RI,TRAC0,TRAC1,ALBC0,ALBC1)
!----------------------------------------------------------------------
!-
!-   Purpose and Methods : SET THE CLOUD COVER, TRANSMISSION AND ALBEDO
!-
!-   Inputs  : SSEC,RI,ASCAT
!-   Outputs : TRAC0,TRAC1,ALBC0,ALBC1
!-   Controls:
!-
!
! Current Code Owner: Bill Collins
!
! History:
! Version   Date     Comment
! -------   ----     -------
!  3.4  03/06/94   Created  W.J. Collins
!  6.1  07/09/04   Added '&' at end of lines for F90 compatability.
!                  M.G. Sanderson
!
!----------------------------------------------------------------------
      IMPLICIT NONE
!----------------------------------------------------------------------
      REAL, INTENT(IN) :: SSEC
      REAL, DIMENSION(0:NLEV), INTENT(IN) :: RI
      REAL, DIMENSION(nlam,0:nlev), INTENT(OUT) :: trac0,trac1,albc0,   &
     &  albc1
      REAL, DIMENSION(nlam) :: tralow=                                  &
     &  (/0.30,0.30,0.30,0.30,0.30,0.30,0.30,0.30,0.30,0.30,0.30,0.30,  &
     &    0.30,0.30,0.30,0.30,0.30,0.30,0.30,0.30,0.30,0.30,0.30,0.30,  &
     &    0.29,0.29,0.29,0.29,0.28,0.28,0.28,0.27,0.27,0.27,0.27,0.27,  &
     &    0.26,0.26,0.26,0.26,0.26,0.26,0.26,0.26,0.26,0.25,0.25,0.25,  &
     &    0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,  &
     &    0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,  &
     &    0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,  &
     &    0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.24,0.24,0.24,0.24,0.24,  &
     &    0.24,0.24,0.24,0.24,0.24,0.24,0.24,0.24,0.24,0.24/)
      REAL, DIMENSION(nlam) :: tramed=                                  &
     &  (/0.50  ,0.50  ,0.50  ,0.50  ,0.50  ,0.50  ,0.50  ,0.50  ,      &
     &    0.50  ,0.50  ,0.50  ,0.50  ,0.50  ,0.50  ,0.50  ,0.50  ,      &
     &    0.50  ,0.50  ,0.50  ,0.50  ,0.50  ,0.50  ,0.50  ,0.50  ,      &
     &    0.4925,0.4925,0.4925,0.4925,0.4825,0.4825,0.4825,0.4725,      &
     &    0.4725,0.4725,0.4725,0.4725,0.4625,0.4625,0.4625,0.4625,      &
     &    0.4625,0.4625,0.4625,0.4625,0.4625,0.4525,0.4525,0.4525,      &
     &    0.4525,0.4525,0.4525,0.4525,0.4525,0.4525,0.4525,0.4525,      &
     &    0.4525,0.4525,0.4525,0.4525,0.4525,0.4525,0.4525,0.4525,      &
     &    0.4525,0.4525,0.4525,0.4525,0.4525,0.4525,0.4525,0.4525,      &
     &    0.4525,0.4525,0.4525,0.4525,0.4525,0.4525,0.4525,0.4525,      &
     &    0.4525,0.4525,0.4525,0.4525,0.4525,0.4525,0.4525,0.4525,      &
     &    0.4525,0.4525,0.4525,0.4425,0.4425,0.4425,0.4425,0.4425,      &
     &    0.4425,0.4425,0.4425,0.4425,0.4425,0.4425,0.4425,0.4425,      &
     &    0.4425,0.4425/)
      REAL, DIMENSION(nlam) :: trahigh=                                 &
     &  (/0.90 ,0.90 ,0.90 ,0.90 ,0.90 ,0.90 ,0.90 ,0.90 ,0.90 ,0.90 ,  &
     &    0.90 ,0.90 ,0.90 ,0.90 ,0.90 ,0.90 ,0.90 ,0.90 ,0.90 ,0.90 ,  &
     &    0.90 ,0.90 ,0.90 ,0.90 ,0.878,0.878,0.878,0.878,0.878,0.878,  &
     &    0.878,0.878,0.878,0.868,0.868,0.868,0.868,0.868,0.868,0.868,  &
     &    0.868,0.868,0.868,0.868,0.868,0.868,0.868,0.868,0.868,0.868,  &
     &    0.868,0.868,0.868,0.868,0.868,0.868,0.868,0.868,0.868,0.868,  &
     &    0.868,0.868,0.868,0.868,0.868,0.868,0.868,0.868,0.858,0.858,  &
     &    0.858,0.858,0.858,0.858,0.858,0.858,0.858,0.858,0.858,0.858,  &
     &    0.858,0.858,0.858,0.858,0.858,0.858,0.858,0.858,0.858,0.858,  &
     &    0.858,0.858,0.858,0.858,0.858,0.858,0.858,0.858,0.858,0.858,  &
     &    0.858,0.858,0.858,0.858,0.858,0.858/)
      INTEGER :: j, ieta, ietamed, ietahigh
      REAL :: MM

      ietamed = INT(ETAMED*100.0)
      ietahigh = INT(ETAHIGH*100.0)

      DO J=0,NLEV
        MM = 1.0/SQRT(1.0-((SSEC/RI(J))**2))
! Convert eta to integer 0-100
        ieta = INT(100.0*Eta_stochem(J))
!
! below eta=0.07 (~700 hPa at P0=1013 hPa)
        IF (ieta <= ietamed) THEN
          TRAC0(:,J)=TRALOW-(0.01*MM)
          TRAC1(:,J)=TRALOW-(0.01*ASCAT)
! between eta=0.07 and eta=0.18(~700-400 hPa)
        ELSE IF (ieta > ietamed .AND. ieta <= ietahigh) THEN
          TRAC0(:,J)=TRAMED-(0.0125*MM)
          TRAC1(:,J)=TRAMED-(0.0125*ASCAT)
! above eta=0.18 (~ 400 hPa)
        ELSE
          TRAC0(:,J)=TRAHIGH-(0.018*MM)
          TRAC1(:,J)=TRAHIGH-(0.018*ASCAT)
        END IF
      END DO

      TRAC0 = MAX(TRAC0,0.0)
      TRAC1 = MAX(TRAC1,0.0)
      ALBC0 = 1.0-TRAC0
      ALBC1 = 1.0-TRAC1

      END SUBROUTINE CLOUDS
      SUBROUTINE GETSIG(jj,tuhere)
!----------------------------------------------------------------------
!-
!-   Purpose and Methods :   To evaluate temperature dependence of cross
!-                           sections.
!-
!-   Inputs : TUHERE,LAMBDA,SGAO3,SGBO3,SGAHNO3,SGTHNO3,SGAHCHO,SGBHCHO,
!-             SGAH2O2,SGBH2O2,SGANO2,SGTNO2,SGAPAN,SGTPAN
!-   Outputs: SGO3,SGNO2,SGHNO3,SGHCHO,SGH2O2,SGPAN,SGN2O5
!-   Controls:
!-
!
! Current Code Owner: Bill Collins
!
! History:
! Version   Date     Comment
! -------   ----     -------
!  3.4  06/06/94   Created  W.J. Collins
!  6.1  07/09/04   Added '&' at end of lines for F90 compatability.
!                  M.G. Sanderson
!
!----------------------------------------------------------------------
      IMPLICIT NONE
!----------------------------------------------------------------------
      INTEGER, INTENT(IN)              :: jj
      REAL, DIMENSION(:,:), INTENT(IN) :: tuhere

      REAL,DIMENSION(jlb) :: iqpart
      INTEGER :: i, k

      iqpart = 1.0 / (1.0+EXP(-10489.0/(TUHERE(jj,:)*8.31441)))

      sgn2o5(:30,:)=0.
      DO k=31,51
        DO i=1,jlb
          sgn2o5(k,i) = 1.0E-20*EXP(2.735+((4728.5 -                    &
     &      (17.127*lambda(k)))/tuhere(jj,i)))
        END DO
      END DO
      sgn2o5(52:,:) = 0.0

      DO k=1,nlam
        DO i=1,jlb
          sgo3(k,i) = sgao3(k)-(((sgao3(k)-sgbo3(k))*(273.0 -           &
     &      tuhere(jj,i)))/70.0)
          sgno2(k,i) = sgano2(k)+(sgtno2(k)*(tuhere(jj,i)-273.0))
          sghno3(k,i) = sgahno3(k)*EXP(sgthno3(k)*(tuhere(jj,i)-298.0))
          sgpan(k,i) = sgapan(k)*EXP(sgtpan(k)*(tuhere(jj,i)-298.0))
          sghcho(k,i) = sgahcho(k)-(((sgahcho(k)-sgbhcho(k))*           &
     &      (293.0-tuhere(jj,i)))/70.0)
          sgh2o2(k,i) = (iqpart(i)*sgah2o2(k))+((1.0-iqpart(i))*        &
     &      sgbh2o2(k))
       END DO
      END DO

      END SUBROUTINE GETSIG
      FUNCTION INCFLX(O3COL,TIME)
!----------------------------------------------------------------------
!-
!-   Purpose and Methods : CALCULATE FLUX INCIDENT ON TOP OF MODEL
!-
!-   Inputs  : SFLUX,O2COL,SGO2,O3COL,SGAO3,SGBO3,MMTOP,time
!-   Outputs : FLUXDN
!-   Controls:
!-
!
! Current Code Owner: Bill Collins
!
! History:
! Version   Date     Comment
! -------   ----     -------
!  3.4  06/06/94   Created  W.J. Collins
!  4.5  14/10/98   Automatic 360/365 day selection. C.E. Johnson
!  6.1  07/09/04   Added '&' at end of lines for F90 compatability.
!                  M.G. Sanderson
!
!-
!VVV  V3.0  INCFLX 23/XI/00   360/365 day selection
!----------------------------------------------------------------------
      IMPLICIT NONE
!----------------------------------------------------------------------
      REAL, DIMENSION(NLAM) :: INCFLX
      REAL, INTENT(IN) :: O3COL,TIME
      REAL :: FSUN,time2,fyear
      REAL, DIMENSION(NLAM) :: SFLUX=                                   &
     & (/ 0.0152,0.0178,0.0220,0.0269,0.0454,0.0714,0.083 ,0.084 ,      &
     &    0.108 ,0.118 ,0.160 ,0.134 ,0.141 ,0.157 ,0.138 ,0.160 ,      &
     &    0.145 ,0.220 ,0.199 ,0.197 ,0.194 ,0.291 ,0.495 ,0.453 ,      &
     &    1.07  ,1.20  ,1.10  ,1.04  ,0.824 ,1.52  ,2.15  ,3.48  ,      &
     &    3.40  ,3.22  ,4.23  ,4.95  ,5.44  ,5.93  ,6.95  ,8.15  ,      &
     &    7.81  ,8.35  ,8.14  ,8.53  ,9.17  ,8.38  ,10.4  ,11.0  ,      &
     &    9.79  ,11.3  ,8.89  ,11.4  ,9.17  ,16.9  ,17.0  ,18.4  ,      &
     &    18.7  ,19.5  ,18.1  ,16.7  ,19.8  ,20.2  ,21.8  ,23.6  ,      &
     &    23.1  ,23.9  ,23.8  ,23.9  ,24.4  ,25.1  ,23.0  ,23.9  ,      &
     &    24.8  ,24.0  ,24.6  ,24.9  ,23.2  ,23.9  ,24.2  ,25.5  ,      &
     &    25.1  ,24.9  ,25.5  ,25.3  ,25.4  ,25.0  ,25.7  ,25.8  ,      &
     &    26.7  ,26.7  ,27.0  ,26.2  ,26.9  ,26.3  ,26.8  ,26.6  ,      &
     &    25.9  ,26.9  ,26.1  ,26.2  ,26.2  ,26.3  ,26.0  ,25.5  ,      &
     &    24.8  ,25.7 /)*1E14

! NEXT LINE ACCOUNTS FOR ELLIPTICAL ORBIT OF EARTH ROUND SUN
! Sun-Earth distance smallest 3 Jan, biggest 4 July
!      hence FSUN is biggest 3 Jan, smallest 4 July

! TIME  is seconds since 0000Z 21st June 0000
! time2 is seconds since 0000Z  3rd Jan  0000
! fyear is fraction of year since 0000Z  3rd Jan

      time2=time+169.0*86400.0
      fyear=mod(time2,YSEC)/YSEC
      FSUN = 1.0+(0.034*COS(2.0*PI*fyear))

! SGO3 IS EQUIVALENT TO TEMPERATURE OF 230K
! ATTENUATION BY THE OXYGEN AND OZONE COLUMNS ABOVE MODEL TOP
      INCFLX = SFLUX*FSUN*EXP(-O2COL*SGO2*MMTOP) *                      &
     &  EXP(-O3COL*((0.39*SGAO3)+(0.61*SGBO3))*MMTOP)

      END FUNCTION INCFLX
      FUNCTION INIAER(ZZ)
!----------------------------------------------------------------------
!-
!-   Purpose and Methods : INITIALISE AEROSOLS
!-
!-   Inputs  : ZZ
!-   Outputs :
!-   Controls:
!-
!
! Current Code Owner: Bill Collins
!
! History:
! Version   Date     Comment
! -------   ----     -------
!  3.4  03/06/94   Created  W.J. Collins
!  6.1  07/09/04   Added '&' at end of lines for F90 compatability.
!                  M.G. Sanderson
!
!----------------------------------------------------------------------
      IMPLICIT NONE
!----------------------------------------------------------------------
      REAL, DIMENSION(0:NLEV), INTENT(IN) :: ZZ

      REAL, DIMENSION(0:NLEV) :: INIAER
      INTEGER, DIMENSION(0:NLEV) :: AH,AL
      REAL, DIMENSION(0:NLEV) :: ACF,DELZ
      REAL, DIMENSION(33) :: ACONC=                                     &
     &  (/215.5 ,70.15 ,17.7  ,7.41  ,2.45  ,0.798 ,0.621 ,0.479 ,      &
     &    0.369 ,0.371 ,0.373 ,0.376 ,0.419 ,0.456 ,0.507 ,0.547 ,      &
     &    0.587 ,0.667 ,0.735 ,0.798 ,0.884 ,0.792 ,0.678 ,0.331 ,      &
     &    0.154 ,0.0701,0.0578,0.0477,0.0394,0.0325,0.0268,0.0219,      &
     &    0.0178/)

! Set the aerosol concentrations centred on the top of each layer
! using exponential interpolation.

      AL = IFIX(ZZ*1E-3)+1
      AL = MIN(AL,32)
      AH = AL+1
      DELZ = ZZ*1E-3+1.0-FLOAT(AL)
      ACF = ALOG(ACONC(AL)/ACONC(AH))
      INIAER = ACONC(AL)*EXP(-ACF*DELZ)

      END FUNCTION INIAER
      SUBROUTINE INIO3(O3,NN,NU,OZONE,O2N)
!----------------------------------------------------------------------
!-
!-   Purpose and Methods : INITIALISE O3 CONCENTRATIONS
!-
!-   Inputs  : O3,NN
!-   Outputs : OZONE,O2N
!-   Controls:
!-
!-   Created   3-JUN-1994   Bill Collins
!-   Revised   5-OCT-1995   Colin Johnson  Now uses model Eulerian
!-                                       ozone Profile, and calculates
!-                                       tropospheric dobson units.
!-
!VVV  V5.2  INIO3 5/9/00 OZONE,O2N,NN are now columns, not densities.
!----------------------------------------------------------------------
      IMPLICIT NONE
!----------------------------------------------------------------------
      REAL, DIMENSION(NLEV), INTENT(IN) :: O3,NU
      REAL, DIMENSION(0:NLEV), INTENT(IN) :: NN
      REAL, DIMENSION(0:NLEV), INTENT(OUT) :: OZONE,O2N

! Set oxygen and ozone columns between half layers
      OZONE(0) = O3(1)*NU(1)/2. ! lowest level is half thickness
      OZONE(NLEV) = O3(NLEV)*NU(NLEV)/2.0 ! top level is half thickness
      OZONE(1:NLEV-1) = (O3(1:NLEV-1)*NU(1:NLEV-1)+                     &
     &   O3(2:NLEV)*NU(2:NLEV))/2.0
      O2N = O2FRAC*NN

      END SUBROUTINE INIO3
      SUBROUTINE INTHRI(tt,pp,pu,tu,nu,zz,dz,ri,nn)
!----------------------------------------------------------------------
!-
!-   Purpose and Methods : INITALISE TEMPERATURES,HEIGHTS,REFRACTIVE
!-                         INDEX
!-
!-   Inputs  : TT,T0,PP
!-   Outputs : PU,TU,ZZ,DZ,RI,NN
!-   Controls:
!-
!-   Created   3-JUN-1994   Bill Collins
!-   Modified 23-OCT-1995   Colin Johnson  To use meteorological data
!-                                         to find thicknesses.
!-   Modified 31-MAR-2000   Colin Johnson  To use AKH,BKH
!-   Modified 23-NOV-2000   Bill Collins   MAIR now in kg/mole

!VVV  V3.0  INTHRI 24/8/00 MAIR NOW IN kg/mole
!----------------------------------------------------------------------
      IMPLICIT NONE
!----------------------------------------------------------------------
      REAL, DIMENSION(0:nlev), INTENT(IN)    :: pp
      REAL, DIMENSION(0:nlev), INTENT(INOUT) :: tt
      REAL, DIMENSION(nlev),   INTENT(OUT)   :: pu
      REAL, DIMENSION(nlev),   INTENT(OUT)   :: tu
      REAL, DIMENSION(nlev),   INTENT(OUT)   :: nu
      REAL, DIMENSION(0:nlev), INTENT(OUT)   :: zz
      REAL, DIMENSION(0:nlev), INTENT(OUT)   :: dz
      REAL, DIMENSION(0:nlev), INTENT(OUT)   :: ri
      REAL, DIMENSION(0:nlev), INTENT(OUT)   :: nn

      INTEGER :: j

      REAL, DIMENSION(nlev) :: hz
      REAL, DIMENSION(nlev) :: zu
! PP,ZZ,TT,NN,RI are on eta_stochem levels
! PU,ZU,TU,HZ are on half levels

! Interpolate temperatures and pressures to mid layer.
      tu(1:nlev)=(tt(0:nlev-1)+tt(1:nlev))/2.0
      pu(1:nlev)=(pp(0:nlev-1)+pp(1:nlev))/2.0

! Find the heights corresponding to the pressure levels.
      hz=(rmol*tu)/(g*mair)
      dz(1)=LOG(pp(1)/pp(0))*(-hz(1))
      zz(1)=dz(1)
      dz(2:nlev)=(LOG(pp(2:nlev)/pp(1:nlev-1))*(-hz(2:nlev)))
      DO j=2,nlev
        zz(j)=zz(j-1)+dz(j)
      END DO
      zu(2:nlev)=zz(1:nlev-1)+(dz(2:nlev)/2.0)
      zu(1)=dz(1)/2.0

! Calculate the thicknesses between the half levels
      dz(nlev)=zz(nlev)-zu(nlev)
      dz(1:nlev-1)=zu(2:nlev)-zu(1:nlev-1)

! Calculate values for the bottom layer.
      zz(0) = zz(1)/4.0
      dz(0) = zu(1)

! Column number density in molecules/cm^2.
! NN is over
      nn(0)=pp(0)-pu(1)
      nu(1)=pp(0)-pp(1)
      nn(1:nlev-1)=pu(1:nlev-1)-pu(2:nlev)
      nu(2:nlev)=pp(1:nlev-1)-pp(2:nlev)
      nn(nlev)=pu(nlev)-pp(nlev)
      nn=nn*na/(g*mair*1.0E4)
      nu=nu*na/(g*mair*1.0E4)

! Set the refractive index at the top of each level in the model
      ri = 1.0+(0.00029*(pp/pstar))

! Convert DZ to cm.
      dz=dz*1.0E+2

      END SUBROUTINE INTHRI
      SUBROUTINE MMCALC(ZENITH,MMTOP,SSEC)
!----------------------------------------------------------------------
!-
!-   Purpose and Methods : Calculate flux angles
!-
!-   Inputs  : ZENITH
!-   Outputs : SSEC,MMTOP,COSSURF
!-   Controls:
!-
!-   Created   3-JUN-1994   Bill Collins
!-
!VVV  V2.2  MMCALC 20/X/99
!----------------------------------------------------------------------
      IMPLICIT NONE
!----------------------------------------------------------------------
      REAL, INTENT(IN) :: ZENITH
      REAL, INTENT(OUT) :: MMTOP,SSEC
      REAL :: SEC,RADCOS

! Calculation of the exponential MM factor for flux attenuation

! First allow for the curvature of the earth (to produce SEC)
! then for the atmospheric refraction
! check for rounding errors which could cause a negative square root

! The "Magic numbers" come from Hough 1988 AERE R-13259 they give
! sensible results only if they are assumed to be in km (or km2)
      RADCOS = 2.0*Earth_Radius*1E-3*COS(ZENITH)
      SEC = ((SQRT((RADCOS**2)+(57.6*Earth_Radius*1.0E-3)+207.36))      &
     &      -RADCOS)/14.4
      SEC = AMAX1(1.0,SEC)
      SSEC = SQRT(1.0-(1.0/SEC)**2)
      MMTOP = SEC
      COSSURF = SQRT(1.0-((SSEC/1.00029)**2))

      END SUBROUTINE MMCALC
      SUBROUTINE SURALB(COSSURF,LANDFR,SEAICEFR,SNOWFR,                 &
     &  ALB0SURF,ALB1SURF)
!----------------------------------------------------------------------
!-
!-   Purpose and Methods : CALCULATE THE SURFACE ALBEDO
!-
!-   Inputs  : COSSURF,ASCAT,FRLAND
!-   Outputs : ALB0SURF,ALB1SURF
!-   Controls:
!-
!
! Current Code Owner: Bill Collins
!
! History:
! Version   Date     Comment
! -------   ----     -------
!  3.4  03/06/94   Created  W.J. Collins
!  6.1  07/09/04   Added '&' at end of lines for F90 compatability.
!                  M.G. Sanderson
!
!----------------------------------------------------------------------
      IMPLICIT NONE
!----------------------------------------------------------------------
      REAL, INTENT(IN) :: cossurf,landfr,seaicefr,snowfr
      REAL, DIMENSION(NLAM), INTENT(OUT) :: alb0surf,alb1surf

      REAL, DIMENSION(nlam) :: albland=                                 &
     &  (/0.05,0.05,0.05,0.05,0.05,0.05,0.05,0.05,0.05,0.05,0.05,0.05,  &
     &    0.05,0.05,0.05,0.05,0.05,0.05,0.05,0.05,0.05,0.05,0.05,0.05,  &
     &    0.05,0.05,0.05,0.05,0.05,0.05,0.05,0.05,0.05,0.05,0.05,0.05,  &
     &    0.05,0.05,0.05,0.05,0.05,0.05,0.05,0.05,0.05,0.05,0.05,0.05,  &
     &    0.05,0.05,0.05,0.05,0.05,0.05,0.06,0.06,0.06,0.06,0.06,0.06,  &
     &    0.06,0.06,0.06,0.06,0.08,0.08,0.08,0.08,0.08,0.08,0.08,0.08,  &
     &    0.08,0.08,0.10,0.10,0.10,0.10,0.10,0.10,0.10,0.10,0.10,0.10,  &
     &    0.11,0.11,0.11,0.11,0.11,0.11,0.11,0.11,0.11,0.11,0.12,0.12,  &
     &    0.12,0.12,0.12,0.12,0.12,0.12,.135,.135,.135,.135/)
      REAL, DIMENSION(NLAM) :: ALBICE=                                  &
     &  (/0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,  &
     &    0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,  &
     &    0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,  &
     &    0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,  &
     &    0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,  &
     &    0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,  &
     &    0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,  &
     &    0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,  &
     &    0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75/)
      REAL :: f0cost, f1cost, frland, frocean, frice

      frland = landfr * (1.0-snowfr)
      frocean = (1.0-landfr) * (1.0-seaicefr)
      frice = (landfr*snowfr) + (1.0-landfr) * seaicefr
      f0cost = 1.6 / (max(cossurf,0.3))
      f1cost = 1.6 * ascat

      alb0surf = frland*albland+frocean*albland*f0cost+frice*albice
      alb1surf = frland*albland+frocean*albland*f1cost+frice*albice

      END SUBROUTINE SURALB

      END SUBROUTINE PHOT

      SUBROUTINE GETO3 (tuhere,out)
!----------------------------------------------------------------------
!-
!-   Purpose and Methods : CALCULATE QUANTUM YIELD FOR O3->O1D
!-
!-   Inputs  : TUHERE
!-   Outputs : GETO3
!-   Controls:
!-
!
! Current Code Owner: Bill Collins
!
! History:
! Version   Date     Comment
! -------   ----     -------
!  3.4  06/06/94   Created  W.J. Collins
!  4.4  14/07/97   Quantum yields from Michelson et al. 1994. Scaled
!                  to IUPAC 1997. R.G. Derwent.
!  5.5  23/02/04   GETO3 now a separate subroutine. M.G. Sanderson
!  6.1  07/09/04   Added '&' at end of lines for F90 compatability.
!                  M.G. Sanderson
!
!----------------------------------------------------------------------
      IMPLICIT NONE
!----------------------------------------------------------------------
      REAL, INTENT(IN), DIMENSION(:,:)    :: tuhere
      REAL, INTENT(OUT), DIMENSION(:,:,:) :: out

      LOGICAL, SAVE                     :: first = .true.
      INTEGER, SAVE, DIMENSION(35:39)   :: i_a

      INTEGER :: i, k, n
      REAL :: wlfrac
      REAL, DIMENSION(SIZE(out,3)) :: qy1
      REAL, DIMENSION(SIZE(out,3)) :: qy2
      REAL, DIMENSION(SIZE(out,3)) :: reus

      out(1:26,:,:) = 0.87
      out(40:56,:,:) = 0.05
      out(57:,:,:) = 0.0

      IF (first) THEN
        DO n = 35,39
          i = 1
          DO
            i = i + 1
            IF ((lambda(n) < wlo1d(i)) .OR. (i==21)) EXIT
          END DO
          i_a(n) = i
       END DO
      END IF

      DO k = 1, nlev
        DO i=1,size(out,3)
          out(27:34,k,i) = 1.98 - 301.0 / lambda(27:34)
        END DO
        reus = 1.0 / (boltz * tuhere(k,:))
!CDIR UNROLL=5
        DO n = 35,39
          i = i_a(n)
          wlfrac = (lambda(n)-wlo1d(i-1)) / (wlo1d(i)-wlo1d(i-1))
          IF (lambda(n) < 320.0) THEN
            qy1 = asco1d(i-1)*alamb(i-1)*EXP(-blamb(i-1) * reus)
            qy2 = asco1d(i)  *alamb(i)  *EXP(-blamb(i) * reus)
          ELSE
            qy1 = asco1d(i-1) * (0.05+alamb(i-1) *                      &
     &        EXP(-blamb(i-1) * reus))
            qy2 = asco1d(i) * (0.05+alamb(i)*                           &
     &        EXP(-blamb(i) * reus))
          END IF
          out(n,k,:) = ((1.0-wlfrac)*qy1) + (wlfrac*qy2)
        END DO
      END DO

      first = .FALSE.

      RETURN

      END SUBROUTINE GETO3

      END MODULE PHOT_MOD
#endif
