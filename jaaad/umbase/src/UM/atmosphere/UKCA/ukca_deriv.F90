#if defined(A34_1A) || defined(A34_1C) || defined(A34_1G)
! *****************************COPYRIGHT*******************************
! (C) Crown copyright Met Office. All rights reserved.
! For further details please refer to the file COPYRIGHT.txt
! which you should have received as part of this distribution.
! *****************************COPYRIGHT*******************************
!
! Description:
!  To perform a chemical integration using the Backward Euler
!  Solver from the STOCHEM model
!
!  Part of the UKCA model, a community model supported by the
!  Met Office and NCAS, with components provided initially
!  by The University of Cambridge, University of Leeds and
!  The Met. Office.  See www.ukca.ac.uk
!
! Method:
!
! Current Code Owner:       Colin Johsnon/Fiona O'Connor
!
!  Code Description:
!   Language:  FORTRAN 90 (formatted)
!   This code is written to UMDP3 v6 programming standards.
!
! ----------------------------------------------------------------------
!
      SUBROUTINE UKCA_DERIV(nr, n_be_calls, n_pnts, ndiags,            &
                          rc, wdep, ddep, dj,                          &
                          h2o, m, o2, vol,                             &
                          dts, ldepd, ldepw, L_ukca_BEflux,            &
                          y, sflux)

      IMPLICIT NONE

#include "nstypes.h"
#include "cmaxsize.h"
#include "cruntimc.h"
#include "parvars.h"
#include "typsize.h"
#include "c_sulchm.h"
      
      INTEGER, INTENT(IN) :: nr         ! No. reactions
      INTEGER, INTENT(IN) :: n_be_calls ! No. chemical steps
      INTEGER, INTENT(IN) :: n_pnts     ! Actual no. calculations
      INTEGER, INTENT(IN) :: ndiags     ! No. chem flux diagnostics

      LOGICAL, INTENT(IN) :: ldepd(jpspec) ! T for dry dep species
      LOGICAL, INTENT(IN) :: ldepw(jpspec) ! T for wet dep species
      LOGICAL, INTENT(IN) :: L_ukca_BEflux ! T for flux diags

      REAL, INTENT(IN)    :: dts                 ! timestep
      REAL, INTENT(IN)    :: rc(n_pnts,nr)       ! rxn rate coeffs
      REAL, INTENT(IN)    :: dj(n_pnts,jppj)     ! photol rates
      REAL, INTENT(IN)    :: wdep(n_pnts,jpspec) ! wet dep rates
      REAL, INTENT(IN)    :: ddep(n_pnts,jpspec) ! dry dep rates
      REAL, INTENT(IN)    :: h2o(n_pnts)         ! h2o concn
      REAL, INTENT(IN)    :: m(n_pnts)           ! air density
      REAL, INTENT(IN)    :: o2(n_pnts)          ! o2 density
      REAL, INTENT(IN)    :: vol(n_pnts)         ! volume of gridboxes

      REAL, INTENT(INOUT) :: y(n_pnts,jpspec)    ! species concn

      REAL, INTENT(OUT)   :: sflux(n_pnts,ndiags)! flux diags

!     Local variables 

      INTEGER, PARAMETER  :: nit=8               ! no of iterations
      INTEGER :: i, j, n                         ! loop variables
      INTEGER :: icnt_dd, icnt_wd                ! indices
            
      REAL :: p(n_pnts)                          ! production rate
      REAL :: p1(n_pnts)                         ! working array
      REAL :: p2(n_pnts)                         ! working array
      REAL :: r1(n_pnts)                         ! working array
      REAL :: r2(n_pnts)                         ! working array
      REAL :: l(n_pnts)                          ! loss rate
      REAL :: l1(n_pnts)                         ! working array
      REAL :: l2(n_pnts)                         ! working array
      REAL :: l3(n_pnts)                         ! working array
      REAL :: yp(n_pnts,jpspec)                  ! previous species concn

!     Initialise flux diagnostics and emission rates to zero

      sflux = 0.0

      DO n = 1, n_be_calls           ! loop over chemical timesteps
            
        DO j = 1,jpspec
          yp(:,j) = y(:,j)
        END DO
        
!       Set constant fields

        yp(:,12) = 5.0e-7*m(:)     ! H2
        yp(:,16) = 350.0e-6*m(:)   ! CO2
        yp(:,19) = h2o(:)          ! H2O
        yp(:,22) = o2(:)           ! O2
        yp(:,23) = m(:) - o2(:)    ! N2
                        
        y (:,12) = yp(:,12)        ! H2
        y (:,16) = yp(:,16)        ! CO2
        y (:,19) = yp(:,19)        ! H2O 
        y (:,22) = yp(:,22)        ! O2
        y (:,23) = yp(:,23)        ! N2       

!       Iteration start

        DO i=1,nit                   ! loop over iterations
        
!         O(3P)        Y( 1)
 
          P(:) = 0.0                                                   & 
     &           +(DJ(:,15) *Y(:,3 ))                                  &            
     &           +(DJ(:,12) *Y(:,5 ))        +(DJ(:,13) *Y(:,22)*2.00) &             
     &           +(RC(:,76) *Y(:,10)*Y(:,10))+(DJ(:,10) *Y(:,6 ))      &             
     &           +(RC(:,49) *Y(:,2 )*Y(:,23))                          & 
     &           +(RC(:,50) *Y(:,2 )*Y(:,22))           
          L(:) = DDEP(:,1) + WDEP(:,1)                                 & 
     &           +(RC(:,44) *Y(:,3 ))                                  & 
     &           +(RC(:,83) *Y(:,6 ))+(RC(:,96) *Y(:,22))       
          Y(:, 1) = P(:)/L(:) 

!         O(1D)        Y( 2)

          P(:) = 0.0                                                   & 
     &           +(DJ(:,14) *Y(:,3 ))                                               
          L(:) = DDEP(:,2) + WDEP(:,2)                                 & 
     &           +(RC(:,48) *Y(:,19))+(RC(:,49) *Y(:,23))              & 
     &           +(RC(:,50) *Y(:,22))                                  & 
     &           +(RC(:,45) *Y(:,14))+(RC(:,46) *Y(:,14))              & 
     &           +(RC(:,47) *Y(:,14))       
          Y(:, 2) = P(:)/L(:) 

!         OH           Y(10)

          P(:) = 0.0                                                   & 
     &           +(DJ(:,1)  *Y(:,34))        +(DJ(:,1)  *Y(:,39))      &            
     &           +(DJ(:,17) *Y(:,21))        +(DJ(:,1)  *Y(:,33))      &             
     &           +(DJ(:,6)  *Y(:,9 ))        +(DJ(:,1)  *Y(:,20))      &             
     &           +(DJ(:,1)  *Y(:,26))        +(DJ(:,2)  *Y(:,13)*2.00) &             
     &           +(RC(:,82) *Y(:,10)*Y(:,34))                          & 
     &           +(RC(:,85) *Y(:,45)*Y(:,44))                          & 
     &           +(RC(:,72) *Y(:,10)*Y(:,39))                          & 
     &           +(RC(:,80) *Y(:,10)*Y(:,33))                          & 
     &           +(RC(:,57) *Y(:,10)*Y(:,26))                          & 
     &           +(RC(:,66) *Y(:,10)*Y(:,20))                          & 
     &           +(RC(:,45) *Y(:,2 )*Y(:,14))                          & 
     &           +(RC(:,48) *Y(:,2 )*Y(:,19)*2.00)                     & 
     &           +(RC(:,3)  *Y(:,11)*Y(:,3 ))                          & 
     &           +(RC(:,10) *Y(:,11)*Y(:,28))                          & 
     &           +(RC(:,1)  *Y(:,11)*Y(:,4 ))                          & 
     &           +(RC(:,2)  *Y(:,11)*Y(:,5 ))                           
          L(:) = DDEP(:,10) + WDEP(:,10)                               & 
     &           +(RC(:,99) *Y(:,10))                                  &            
     &           +(RC(:,97) *Y(:,4 ))+(RC(:,98) *Y(:,6 ))              & 
     &           +(RC(:,99) *Y(:,10))                                  & 
     &           +(RC(:,80) *Y(:,33))+(RC(:,81) *Y(:,34))              & 
     &           +(RC(:,82) *Y(:,34))                                  & 
     &           +(RC(:,77) *Y(:,29))+(RC(:,78) *Y(:,40))              & 
     &           +(RC(:,79) *Y(:,33))                                  & 
     &           +(RC(:,75) *Y(:,3 ))+(RC(:,76) *Y(:,10))              & 
     &           +(RC(:,76) *Y(:,10))                                  & 
     &           +(RC(:,72) *Y(:,39))+(RC(:,73) *Y(:,27))              & 
     &           +(RC(:,74) *Y(:,5 ))                                  & 
     &           +(RC(:,69) *Y(:,37))+(RC(:,70) *Y(:,37))              & 
     &           +(RC(:,71) *Y(:,39))                                  & 
     &           +(RC(:,66) *Y(:,20))+(RC(:,67) *Y(:,20))              & 
     &           +(RC(:,68) *Y(:,41))                                  & 
     &           +(RC(:,63) *Y(:,8 ))+(RC(:,64) *Y(:,9 ))              & 
     &           +(RC(:,65) *Y(:,21))                                  & 
     &           +(RC(:,60) *Y(:,13))+(RC(:,61) *Y(:,17))              & 
     &           +(RC(:,62) *Y(:,11))                                  & 
     &           +(RC(:,57) *Y(:,26))+(RC(:,58) *Y(:,26))              & 
     &           +(RC(:,59) *Y(:,12))                                  & 
     &           +(RC(:,54) *Y(:,30))+(RC(:,55) *Y(:,15))              & 
     &           +(RC(:,56) *Y(:,35))                                  & 
     &           +(RC(:,51) *Y(:,14))+(RC(:,52) *Y(:,24))              & 
     &           +(RC(:,53) *Y(:,30))       
          Y(:,10) = P(:)/L(:) 

!         O3           Y( 3)

          P(:) = 0.0                                                   & 
     &           +(RC(:,96) *Y(:,1 )*Y(:,22))                          &             
     &           +(RC(:,9)  *Y(:,11)*Y(:,28))                          & 
     &           +(RC(:,14) *Y(:,11)*Y(:,36))           
          L(:) = DDEP(:,3) + WDEP(:,3)                                 & 
     &           +(DJ(:,15) )                                          &             
     &           +(RC(:,44) *Y(:,1 ))                                  & 
     &           +(RC(:,75) *Y(:,10))+(DJ(:,14) )                      & 
     &           +(RC(:,3)  *Y(:,11))+(RC(:,37) *Y(:,4 ))              & 
     &           +(RC(:,38) *Y(:,6 ))       
          Y(:, 3) = (YP(:, 3)+DTS*P(:))/(1.0+DTS*L(:)) 

!         NO           Y( 4)

          P(:) = 0.0                                                   & 
     &           +(DJ(:,11) *Y(:,5 ))        +(DJ(:,17) *Y(:,21))      &             
     &           +(RC(:,83) *Y(:,1 )*Y(:,6 ))+(DJ(:,10) *Y(:,6 ))                   
          L(:) = DDEP(:,4) + WDEP(:,4)                                 & 
     &           +(RC(:,36) *Y(:,5 ))+(RC(:,37) *Y(:,3 ))              & 
     &           +(RC(:,97) *Y(:,10))                                  & 
     &           +(RC(:,30) *Y(:,32))+(RC(:,32) *Y(:,36))              & 
     &           +(RC(:,34) *Y(:,38))                                  & 
     &           +(RC(:,23) *Y(:,25))+(RC(:,26) *Y(:,28))              & 
     &           +(RC(:,28) *Y(:,31))                                  & 
     &           +(RC(:,1)  *Y(:,11))+(RC(:,16) *Y(:,18))              & 
     &           +(RC(:,17) *Y(:,18))                                   
          Y(:, 4) = (YP(:, 4)+DTS*P(:))/(1.0+DTS*L(:)) 

!         NO2          Y( 6)

          P(:) = 0.0                                                   & 
     &           +(DJ(:,20) *Y(:,41))                                  &             
     &           +(DJ(:,16) *Y(:,29))        +(DJ(:,16) *Y(:,40))      &             
     &           +(DJ(:,9)  *Y(:,7 ))        +(DJ(:,12) *Y(:,5 ))      &             
     &           +(DJ(:,5)  *Y(:,8 ))        +(DJ(:,6)  *Y(:,9 ))      &             
     &           +(RC(:,94) *Y(:,7 ))        +(RC(:,101)*Y(:,40))      &             
     &           +(RC(:,91) *Y(:,8 ))        +(RC(:,93) *Y(:,29))      &             
     &           +(RC(:,77) *Y(:,10)*Y(:,29))                          & 
     &           +(RC(:,78) *Y(:,10)*Y(:,40))                          & 
     &           +(RC(:,68) *Y(:,10)*Y(:,41))                          & 
     &           +(RC(:,74) *Y(:,10)*Y(:,5 ))                          & 
     &           +(RC(:,63) *Y(:,10)*Y(:,8 ))                          & 
     &           +(RC(:,65) *Y(:,10)*Y(:,21))                          & 
     &           +(RC(:,36) *Y(:,4 )*Y(:,5 )*2.00)                     & 
     &           +(RC(:,37) *Y(:,4 )*Y(:,3 ))                          & 
     &           +(RC(:,34) *Y(:,38)*Y(:,4 ))                          & 
     &           +(RC(:,35) *Y(:,38)*Y(:,5 ))                          & 
     &           +(RC(:,32) *Y(:,36)*Y(:,4 ))                          & 
     &           +(RC(:,33) *Y(:,36)*Y(:,5 ))                          & 
     &           +(RC(:,30) *Y(:,32)*Y(:,4 ))                          & 
     &           +(RC(:,31) *Y(:,32)*Y(:,5 ))                          & 
     &           +(RC(:,28) *Y(:,31)*Y(:,4 ))                          & 
     &           +(RC(:,29) *Y(:,31)*Y(:,5 ))                          & 
     &           +(RC(:,26) *Y(:,28)*Y(:,4 ))                          & 
     &           +(RC(:,27) *Y(:,28)*Y(:,5 ))                          & 
     &           +(RC(:,23) *Y(:,25)*Y(:,4 ))                          & 
     &           +(RC(:,24) *Y(:,25)*Y(:,5 ))                          & 
     &           +(RC(:,16) *Y(:,18)*Y(:,4 ))                          & 
     &           +(RC(:,18) *Y(:,18)*Y(:,5 ))                          & 
     &           +(RC(:,1)  *Y(:,11)*Y(:,4 ))                          & 
     &           +(RC(:,2)  *Y(:,11)*Y(:,5 ))           
          L(:) = DDEP(:,6) + WDEP(:,6)                                 & 
     &           +(RC(:,100)*Y(:,36))+(DJ(:,10) )                      &             
     &           +(RC(:,92) *Y(:,28))+(RC(:,95) *Y(:,5 ))              & 
     &           +(RC(:,98) *Y(:,10))                                  & 
     &           +(RC(:,38) *Y(:,3 ))+(RC(:,83) *Y(:,1 ))              & 
     &           +(RC(:,90) *Y(:,11))       
          Y(:, 6) = (YP(:, 6)+DTS*P(:))/(1.0+DTS*L(:)) 

!         NO3/N2O5  Y(:, 5)/Y(:, 7)

          P1(:) = 0.0                                                  & 
     &            +(RC(:,38) *Y(:,6 )*Y(:,3 ))                         & 
     &            +(RC(:,64) *Y(:,10)*Y(:,9 ))         
          L(:) = DDEP(:,5) + WDEP(:,5)                                 & 
     &           +(DJ(:,11) )        +(DJ(:,12) )                      &             
     &           +(RC(:,42) *Y(:,37))+(RC(:,74) *Y(:,10))              & 
     &           +(RC(:,95) *Y(:,6 ))                                  & 
     &           +(RC(:,39) *Y(:,17))+(RC(:,40) *Y(:,27))              & 
     &           +(RC(:,41) *Y(:,35))                                  & 
     &           +(RC(:,33) *Y(:,36))+(RC(:,35) *Y(:,38))              & 
     &           +(RC(:,36) *Y(:,4 ))                                  & 
     &           +(RC(:,27) *Y(:,28))+(RC(:,29) *Y(:,31))              & 
     &           +(RC(:,31) *Y(:,32))                                  & 
     &           +(RC(:,2)  *Y(:,11))+(RC(:,18) *Y(:,18))              & 
     &           +(RC(:,24) *Y(:,25))    
          P2(:) = 0.0 
          R1(:) = RC(:,94) + DJ(:,9) 
          R2(:) = RC(:,95) *Y(:,6 ) 
          L1(:) = DDEP(:,7) + WDEP(:,7)                                & 
     &            +(RC(:,43) *Y(:,19))+(RC(:,94) )        +(DJ(:,9)  )      
          L2(:) = 1.0+L(:)*DTS 
          L3(:) = 1.0+L1(:)*DTS 
          Y(:,5) = (L3(:)*(YP(:,5)+P1(:)*DTS)+R1(:)*DTS*YP(:,7))/      & 
     &               ((L3(:)*L2(:))-R1(:)*R2(:)*DTS**2.0) 
          Y(:,7) = (YP(:,7) + P2(:)*DTS + R2(:)*DTS*Y(:,5))/L3(:) 

!         HO2NO2       Y( 8)

          P(:) = 0.0                                                   & 
     &           +(RC(:,90) *Y(:,11)*Y(:,6 ))                                       
          L(:) = DDEP(:,8) + WDEP(:,8)                                 & 
     &           +(RC(:,63) *Y(:,10))+(RC(:,91) )        +(DJ(:,5)  )               
          Y(:, 8) = (YP(:, 8)+DTS*P(:))/(1.0+DTS*L(:)) 

!         HONO2        Y( 9)

          P(:) = 0.0                                                   & 
     &           +(RC(:,43) *Y(:,7 )*Y(:,19)*2.00)                     & 
     &           +(RC(:,98) *Y(:,10)*Y(:,6 ))                          & 
     &           +(RC(:,41) *Y(:,5 )*Y(:,35))                          & 
     &           +(RC(:,42) *Y(:,5 )*Y(:,37))                          & 
     &           +(RC(:,39) *Y(:,5 )*Y(:,17))                          & 
     &           +(RC(:,40) *Y(:,5 )*Y(:,27))                           
          L(:) = DDEP(:,9) + WDEP(:,9)                                 & 
     &           +(RC(:,64) *Y(:,10))+(DJ(:,6)  )                                  
          Y(:, 9) = (YP(:, 9)+DTS*P(:))/(1.0+DTS*L(:)) 

!         HO2          Y(11)

          P(:) = 0.0                                                   & 
     &           +(DJ(:,1)  *Y(:,34))        +(DJ(:,20) *Y(:,41))      &             
     &           +(DJ(:,18) *Y(:,35))        +(DJ(:,1)  *Y(:,33))      &             
     &           +(DJ(:,7)  *Y(:,27))        +(DJ(:,1)  *Y(:,20))      &             
     &           +(DJ(:,3)  *Y(:,17)*2.00)        +(DJ(:,5)  *Y(:,8 )) &             
     &           +(RC(:,91) *Y(:,8 ))        +(DJ(:,1)  *Y(:,26))      &             
     &           +(RC(:,75) *Y(:,10)*Y(:,3 ))                          & 
     &           +(RC(:,84) *Y(:,46)*Y(:,44))                          & 
     &           +(RC(:,61) *Y(:,10)*Y(:,17))                          & 
     &           +(RC(:,74) *Y(:,10)*Y(:,5 ))                          & 
     &           +(RC(:,59) *Y(:,10)*Y(:,12))                          & 
     &           +(RC(:,60) *Y(:,10)*Y(:,13))                          & 
     &           +(RC(:,47) *Y(:,2 )*Y(:,14)*2.00)                     & 
     &           +(RC(:,55) *Y(:,10)*Y(:,15))                          & 
     &           +(RC(:,31) *Y(:,32)*Y(:,5 ))                          & 
     &           +(RC(:,39) *Y(:,5 )*Y(:,17))                          & 
     &           +(RC(:,29) *Y(:,31)*Y(:,5 ))                          & 
     &           +(RC(:,30) *Y(:,32)*Y(:,4 ))                          & 
     &           +(RC(:,25) *Y(:,25)*Y(:,28))                          & 
     &           +(RC(:,28) *Y(:,31)*Y(:,4 ))                          & 
     &           +(RC(:,23) *Y(:,25)*Y(:,4 ))                          & 
     &           +(RC(:,24) *Y(:,25)*Y(:,5 ))                          & 
     &           +(RC(:,20) *Y(:,18)*Y(:,18)*2.00)                     & 
     &           +(RC(:,21) *Y(:,18)*Y(:,28))                          & 
     &           +(RC(:,16) *Y(:,18)*Y(:,4 ))                          & 
     &           +(RC(:,18) *Y(:,18)*Y(:,5 ))                           
          L(:) = DDEP(:,11) + WDEP(:,11)                               & 
     &           +(RC(:,89) *Y(:,11))+(RC(:,90) *Y(:,6 ))              &             
     &           +(RC(:,15) *Y(:,38))+(RC(:,62) *Y(:,10))              & 
     &           +(RC(:,89) *Y(:,11))                                  & 
     &           +(RC(:,12) *Y(:,32))+(RC(:,13) *Y(:,36))              & 
     &           +(RC(:,14) *Y(:,36))                                  & 
     &           +(RC(:,9)  *Y(:,28))+(RC(:,10) *Y(:,28))              & 
     &           +(RC(:,11) *Y(:,31))                                  & 
     &           +(RC(:,6)  *Y(:,18))+(RC(:,7)  *Y(:,25))              & 
     &           +(RC(:,8)  *Y(:,28))                                  & 
     &           +(RC(:,4)  *Y(:,11))+(RC(:,4)  *Y(:,11))              & 
     &           +(RC(:,5)  *Y(:,18))                                  & 
     &           +(RC(:,1)  *Y(:,4 ))+(RC(:,2)  *Y(:,5 ))              & 
     &           +(RC(:,3)  *Y(:,3 ))       
          Y(:,11) = (YP(:,11)+DTS*P(:))/(1.0+DTS*L(:))  

!         H2O2         Y(13)

          P(:) = 0.0                                                   & 
     &           +(RC(:,99) *Y(:,10)*Y(:,10))                          &             
     &           +(RC(:,4)  *Y(:,11)*Y(:,11))                          & 
     &           +(RC(:,89) *Y(:,11)*Y(:,11))           
          L(:) = DDEP(:,13) + WDEP(:,13)                               & 
     &           +(RC(:,60) *Y(:,10))+(DJ(:,2)  )                                   
          Y(:,13) = (YP(:,13)+DTS*P(:))/(1.0+DTS*L(:)) 

!         CH4          Y(14)

          P(:) = 0.0                                                   & 
     &           +(DJ(:,8)  *Y(:,27))                                               
          L(:) = DDEP(:,14) + WDEP(:,14)                               & 
     &           +(RC(:,51) *Y(:,10))                                  &             
     &           +(RC(:,45) *Y(:,2 ))+(RC(:,46) *Y(:,2 ))              & 
     &           +(RC(:,47) *Y(:,2 ))       
          Y(:,14) = (YP(:,14)+DTS*P(:))/(1.0+DTS*L(:)) 

!         CO           Y(15)

          P(:) = 0.0                                                   & 
     &           +(DJ(:,18) *Y(:,35))                                  &             
     &           +(DJ(:,7)  *Y(:,27))        +(DJ(:,8)  *Y(:,27))      &             
     &           +(DJ(:,3)  *Y(:,17))        +(DJ(:,4)  *Y(:,17))      &             
     &           +(RC(:,39) *Y(:,5 )*Y(:,17))                          & 
     &           +(RC(:,61) *Y(:,10)*Y(:,17))           
          L(:) = DDEP(:,15) + WDEP(:,15)                               & 
     &           +(RC(:,55) *Y(:,10))                                               
          Y(:,15) = (YP(:,15)+DTS*P(:))/(1.0+DTS*L(:)) 

!         HCHO         Y(17)

          P(:) = 0.0                                                   & 
     &           +(DJ(:,20) *Y(:,41))                                  &              
     &           +(DJ(:,1)  *Y(:,20))        +(DJ(:,1)  *Y(:,39))      &              
     &           +(RC(:,68) *Y(:,10)*Y(:,41))                          & 
     &           +(RC(:,77) *Y(:,10)*Y(:,29))                          & 
     &           +(RC(:,47) *Y(:,2 )*Y(:,14))                          & 
     &           +(RC(:,66) *Y(:,10)*Y(:,20))                          & 
     &           +(RC(:,35) *Y(:,38)*Y(:,5 ))                          & 
     &           +(RC(:,46) *Y(:,2 )*Y(:,14))                          & 
     &           +(RC(:,22) *Y(:,18)*Y(:,28))                          & 
     &           +(RC(:,34) *Y(:,38)*Y(:,4 ))                          & 
     &           +(RC(:,20) *Y(:,18)*Y(:,18)*2.00)                     & 
     &           +(RC(:,21) *Y(:,18)*Y(:,28))                          & 
     &           +(RC(:,18) *Y(:,18)*Y(:,5 ))                          & 
     &           +(RC(:,19) *Y(:,18)*Y(:,18))                          & 
     &           +(RC(:,6)  *Y(:,11)*Y(:,18))                          & 
     &           +(RC(:,16) *Y(:,18)*Y(:,4 ))           
          L(:) = DDEP(:,17) + WDEP(:,17)                               & 
     &           +(DJ(:,4)  )                                          &               
     &           +(RC(:,39) *Y(:,5 ))+(RC(:,61) *Y(:,10))+(DJ(:,3)  )               
          Y(:,17) = (YP(:,17)+DTS*P(:))/(1.0+DTS*L(:)) 

!         MeOO         Y(18)

          P(:) = 0.0                                                   & 
     &           +(DJ(:,7)  *Y(:,27))        +(DJ(:,19) *Y(:,37))      &              
     &           +(RC(:,51) *Y(:,10)*Y(:,14))                          & 
     &           +(RC(:,67) *Y(:,10)*Y(:,20))                          & 
     &           +(RC(:,27) *Y(:,28)*Y(:,5 ))                          & 
     &           +(RC(:,45) *Y(:,2 )*Y(:,14))                          & 
     &           +(RC(:,25) *Y(:,25)*Y(:,28))                          & 
     &           +(RC(:,26) *Y(:,28)*Y(:,4 ))                          & 
     &           +(RC(:,10) *Y(:,11)*Y(:,28))                          & 
     &           +(RC(:,21) *Y(:,18)*Y(:,28))           
          L(:) = DDEP(:,18) + WDEP(:,18)                               & 
     &           +(RC(:,21) *Y(:,28))+(RC(:,22) *Y(:,28))              &                  
     &           +(RC(:,19) *Y(:,18))+(RC(:,20) *Y(:,18))              & 
     &           +(RC(:,20) *Y(:,18))                                  & 
     &           +(RC(:,17) *Y(:,4 ))+(RC(:,18) *Y(:,5 ))              & 
     &           +(RC(:,19) *Y(:,18))                                  & 
     &           +(RC(:,5)  *Y(:,11))+(RC(:,6)  *Y(:,11))              & 
     &           +(RC(:,16) *Y(:,4 ))                  
          Y(:,18) = (YP(:,18)+DTS*P(:))/(1.0+DTS*L(:)) 

!         MeOOH        Y(20)

          P(:) = 0.0                                                   & 
     &           +(RC(:,5)  *Y(:,11)*Y(:,18))                                       
          L(:) = DDEP(:,20) + WDEP(:,20)                               & 
     &           +(RC(:,66) *Y(:,10))+(RC(:,67) *Y(:,10))+(DJ(:,1)  )               
          Y(:,20) = (YP(:,20)+DTS*P(:))/(1.0+DTS*L(:)) 

!         HONO         Y(21)

          P(:) = 0.0                                                   & 
     &           +(RC(:,97) *Y(:,10)*Y(:,4 ))                                       
          L(:) = DDEP(:,21) + WDEP(:,21)                               & 
     &           +(RC(:,65) *Y(:,10))+(DJ(:,17) )                                    
          Y(:,21) = (YP(:,21)+DTS*P(:))/(1.0+DTS*L(:)) 

!         C2H6         Y(24)

          P(:) = 0.0 
          L(:) = DDEP(:,24) + WDEP(:,24)                               & 
     &           +(RC(:,52) *Y(:,10))                                               
          Y(:,24) = (YP(:,24)+DTS*P(:))/(1.0+DTS*L(:)) 

!         EtOO         Y(25)

          P(:) = 0.0                                                   & 
     &           +(DJ(:,18) *Y(:,35))                                  &         
     &           +(RC(:,52) *Y(:,10)*Y(:,24))                          & 
     &           +(RC(:,58) *Y(:,10)*Y(:,26))                          & 
     &           +(RC(:,32) *Y(:,36)*Y(:,4 ))                          & 
     &           +(RC(:,33) *Y(:,36)*Y(:,5 ))           
          L(:) = DDEP(:,25) + WDEP(:,25)                               & 
     &           +(RC(:,25) *Y(:,28))                                  &          
     &           +(RC(:,7)  *Y(:,11))+(RC(:,23) *Y(:,4 ))              & 
     &           +(RC(:,24) *Y(:,5 ))       
          Y(:,25) = (YP(:,25)+DTS*P(:))/(1.0+DTS*L(:)) 

!         EtOOH        Y(26)

          P(:) = 0.0                                                   & 
     &           +(RC(:,7)  *Y(:,11)*Y(:,25))                                       
          L(:) = DDEP(:,26) + WDEP(:,26)                               &                        
     &           +(RC(:,57) *Y(:,10))+(RC(:,58) *Y(:,10))+(DJ(:,1)  )               
          Y(:,26) = (YP(:,26)+DTS*P(:))/(1.0+DTS*L(:)) 

!         MeCHO        Y(27)

          P(:) = 0.0                                                   & 
     &           +(RC(:,78) *Y(:,10)*Y(:,40))+(DJ(:,1)  *Y(:,26))      &         
     &           +(RC(:,25) *Y(:,25)*Y(:,28))                          & 
     &           +(RC(:,57) *Y(:,10)*Y(:,26))                          & 
     &           +(RC(:,23) *Y(:,25)*Y(:,4 ))                          & 
     &           +(RC(:,24) *Y(:,25)*Y(:,5 ))           
          L(:) = DDEP(:,27) + WDEP(:,27)                               & 
     &           +(DJ(:,8)  )                                          &              
     &           +(RC(:,40) *Y(:,5 ))+(RC(:,73) *Y(:,10))+(DJ(:,7)  )               
          Y(:,27) = (YP(:,27)+DTS*P(:))/(1.0+DTS*L(:)) 

!         MeCO3        Y(28)

          P(:) = 0.0                                                   & 
     &           +(DJ(:,19) *Y(:,37))        +(DJ(:,1)  *Y(:,39))      &         
     &           +(RC(:,93) *Y(:,29))        +(DJ(:,16) *Y(:,29))      &         
     &           +(RC(:,40) *Y(:,5 )*Y(:,27))                          & 
     &           +(RC(:,73) *Y(:,10)*Y(:,27))                          & 
     &           +(RC(:,34) *Y(:,38)*Y(:,4 ))                          & 
     &           +(RC(:,35) *Y(:,38)*Y(:,5 ))           
          L(:) = DDEP(:,28) + WDEP(:,28)                               & 
     &           +(RC(:,26) *Y(:,4 ))+(RC(:,27) *Y(:,5 ))              & 
     &           +(RC(:,92) *Y(:,6 ))                                  & 
     &           +(RC(:,21) *Y(:,18))+(RC(:,22) *Y(:,18))              & 
     &           +(RC(:,25) *Y(:,25))                                  & 
     &           +(RC(:,8)  *Y(:,11))+(RC(:,9)  *Y(:,11))              & 
     &           +(RC(:,10) *Y(:,11))       
          Y(:,28) = (YP(:,28)+DTS*P(:))/(1.0+DTS*L(:)) 

!         PAN          Y(29)

          P(:) = 0.0                                                   & 
     &           +(RC(:,92) *Y(:,28)*Y(:,6 ))                                       
          L(:) = DDEP(:,29) + WDEP(:,29)                               & 
     &           +(RC(:,77) *Y(:,10))+(RC(:,93) )        +(DJ(:,16) )               
          Y(:,29) = (YP(:,29)+DTS*P(:))/(1.0+DTS*L(:)) 

!         C3H8         Y(30)

          P(:) = 0.0 
          L(:) = DDEP(:,30) + WDEP(:,30)                               & 
     &           +(RC(:,53) *Y(:,10))+(RC(:,54) *Y(:,10))                           
          Y(:,30) = (YP(:,30)+DTS*P(:))/(1.0+DTS*L(:)) 

!         n-PrOO       Y(31)

          P(:) = 0.0                                                   & 
     &           +(RC(:,53) *Y(:,10)*Y(:,30))                          & 
     &           +(RC(:,79) *Y(:,10)*Y(:,33))           
          L(:) = DDEP(:,31) + WDEP(:,31)                               & 
     &           +(RC(:,11) *Y(:,11))+(RC(:,28) *Y(:,4 ))              & 
     &           +(RC(:,29) *Y(:,5 ))       
          Y(:,31) = (YP(:,31)+DTS*P(:))/(1.0+DTS*L(:)) 

!         i-PrOO       Y(32)

          P(:) = 0.0                                                   & 
     &           +(RC(:,54) *Y(:,10)*Y(:,30))                          & 
     &           +(RC(:,81) *Y(:,10)*Y(:,34))           
          L(:) = DDEP(:,32) + WDEP(:,32)                               & 
     &           +(RC(:,12) *Y(:,11))+(RC(:,30) *Y(:,4 ))              & 
     &           +(RC(:,31) *Y(:,5 ))       
          Y(:,32) = (YP(:,32)+DTS*P(:))/(1.0+DTS*L(:)) 

!         n-PrOOH      Y(33)

          P(:) = 0.0                                                   & 
     &           +(RC(:,11) *Y(:,11)*Y(:,31))                                       
          L(:) = DDEP(:,33) + WDEP(:,33)                               & 
     &           +(RC(:,79) *Y(:,10))+(RC(:,80) *Y(:,10))+(DJ(:,1)  )               
          Y(:,33) = (YP(:,33)+DTS*P(:))/(1.0+DTS*L(:)) 

!         i-PrOOH      Y(34)

          P(:) = 0.0                                                   & 
     &           +(RC(:,12) *Y(:,11)*Y(:,32))                                       
          L(:) = DDEP(:,34) + WDEP(:,34)                               & 
     &           +(RC(:,81) *Y(:,10))+(RC(:,82) *Y(:,10))+(DJ(:,1)  )               
          Y(:,34) = (YP(:,34)+DTS*P(:))/(1.0+DTS*L(:)) 

!         EtCHO        Y(35)

          P(:) = 0.0                                                   & 
     &           +(RC(:,80) *Y(:,10)*Y(:,33))+(DJ(:,1)  *Y(:,33))      &         
     &           +(RC(:,28) *Y(:,31)*Y(:,4 ))                          & 
     &           +(RC(:,29) *Y(:,31)*Y(:,5 ))           
          L(:) = DDEP(:,35) + WDEP(:,35)                               & 
     &           +(RC(:,41) *Y(:,5 ))                                  & 
     &           +(RC(:,56) *Y(:,10))+(DJ(:,18) )               
          Y(:,35) = (YP(:,35)+DTS*P(:))/(1.0+DTS*L(:)) 

!         EtCO3        Y(36)

          P(:) = 0.0                                                   & 
     &           +(RC(:,101)*Y(:,40))        +(DJ(:,16) *Y(:,40))      &           
     &           +(RC(:,41) *Y(:,5 )*Y(:,35))                          & 
     &           +(RC(:,56) *Y(:,10)*Y(:,35))                               
          L(:) = DDEP(:,36) + WDEP(:,36)                               &         
     &           +(RC(:,33) *Y(:,5 ))+(RC(:,100)*Y(:,6 ))              &         
     &           +(RC(:,13) *Y(:,11))+(RC(:,14) *Y(:,11))              & 
     &           +(RC(:,32) *Y(:,4 ))       
          Y(:,36) = (YP(:,36)+DTS*P(:))/(1.0+DTS*L(:)) 

!         Me2CO        Y(37)

          P(:) = 0.0                                                   & 
     &           +(RC(:,82) *Y(:,10)*Y(:,34))+(DJ(:,1)  *Y(:,34))      &          
     &           +(RC(:,30) *Y(:,32)*Y(:,4 ))                          & 
     &           +(RC(:,31) *Y(:,32)*Y(:,5 ))           
          L(:) = DDEP(:,37) + WDEP(:,37)                               & 
     &           +(DJ(:,19) )                                          &          
     &           +(RC(:,42) *Y(:,5 ))+(RC(:,69) *Y(:,10))              & 
     &           +(RC(:,70) *Y(:,10))      
          Y(:,37) = (YP(:,37)+DTS*P(:))/(1.0+DTS*L(:)) 

!         MeCOCH2O     Y(38)

          P(:) = 0.0                                                   & 
     &           +(RC(:,70) *Y(:,10)*Y(:,37))                          & 
     &           +(RC(:,71) *Y(:,10)*Y(:,39))                          & 
     &           +(RC(:,42) *Y(:,5 )*Y(:,37))                          & 
     &           +(RC(:,69) *Y(:,10)*Y(:,37))           
          L(:) = DDEP(:,38) + WDEP(:,38)                               & 
     &           +(RC(:,15) *Y(:,11))+(RC(:,34) *Y(:,4 ))              & 
     &           +(RC(:,35) *Y(:,5 ))       
          Y(:,38) = (YP(:,38)+DTS*P(:))/(1.0+DTS*L(:)) 

!         MeCOCH2O     Y(39)

          P(:) = 0.0                                                   & 
     &           +(RC(:,15) *Y(:,11)*Y(:,38))                                       
          L(:) = DDEP(:,39) + WDEP(:,39)                               & 
     &           +(RC(:,71) *Y(:,10))+(RC(:,72) *Y(:,10))+(DJ(:,1)  )               
          Y(:,39) = (YP(:,39)+DTS*P(:))/(1.0+DTS*L(:)) 

!         PPAN         Y(40)

          P(:) = 0.0                                                   & 
     &           +(RC(:,100)*Y(:,36)*Y(:,6 ))                                       
          L(:) = DDEP(:,40) + WDEP(:,40)                               & 
     &           +(RC(:,78) *Y(:,10))+(RC(:,101))        +(DJ(:,16) )               
          Y(:,40) = (YP(:,40)+DTS*P(:))/(1.0+DTS*L(:)) 

!         MeONO2       Y(41)

          P(:) = 0.0                                                   & 
     &           +(RC(:,17) *Y(:,18)*Y(:,4 ))                                       
          L(:) = DDEP(:,41) + WDEP(:,41)                               & 
     &           +(RC(:,68) *Y(:,10))+(DJ(:,20) )                                   
          Y(:,41) = (YP(:,41)+DTS*P(:))/(1.0+DTS*L(:)) 

!         O(3P)S       Y(42)

          P(:) = 0.0                                                   & 
     &           +(DJ(:,15) *Y(:,44))                                  &         
     &           +(RC(:,87) *Y(:,43)*Y(:,23))                          & 
     &           +(RC(:,88) *Y(:,43)*Y(:,22))           
          L(:) = DDEP(:,42) + WDEP(:,42)                               & 
     &           +(RC(:,102)*Y(:,22))                                               
          Y(:,42) = (YP(:,42)+DTS*P(:))/(1.0+DTS*L(:)) 

!         O(1D)S       Y(43)

          P(:) = 0.0                                                   & 
     &           +(DJ(:,14) *Y(:,44))                                                 
          L(:) = DDEP(:,43) + WDEP(:,43)                               & 
     &           +(RC(:,86) *Y(:,19))+(RC(:,87) *Y(:,23))              & 
     &           +(RC(:,88) *Y(:,22))       
          Y(:,43) = (YP(:,43)+DTS*P(:))/(1.0+DTS*L(:)) 

!         O3S          Y(44)

          P(:) = 0.0                                                   & 
     &           +(RC(:,102)*Y(:,42)*Y(:,22))                                       
          L(:) = DDEP(:,44) + WDEP(:,44)                               & 
     &           +(DJ(:,15) )                                          &         
     &           +(RC(:,84) *Y(:,46))+(RC(:,85) *Y(:,45))+(DJ(:,14) )               
          Y(:,44) = (YP(:,44)+DTS*P(:))/(1.0+DTS*L(:)) 

!         OHS          Y(45)

          P(:) = 0.0 
          L(:) = DDEP(:,45) + WDEP(:,45)                               & 
     &           +(RC(:,85) *Y(:,44))                                               
          Y(:,45) = (YP(:,45)+DTS*P(:))/(1.0+DTS*L(:)) 

!         HO2S         Y(46)

          P(:) = 0.0 
          L(:) = DDEP(:,46) + WDEP(:,46)                               & 
     &           +(RC(:,84) *Y(:,44))                                               
          Y(:,46) = (YP(:,46)+DTS*P(:))/(1.0+DTS*L(:)) 

        END DO ! End of iteration loop stop

!       At end of iteration, calculate flux terms.

        IF (L_ukca_BEflux) THEN

!         R1      HO2       +NO        =OH        +NO2
          sflux(:,1) = sflux(:,1) + RC(:,1)*Y(:,11)*Y(:,4)*DTS*Vol(:)

!         R2      HO2       +NO3       =OH        +NO2
          sflux(:,2) = sflux(:,2) + RC(:,2)*Y(:,11)*Y(:,5)*DTS*Vol(:)

!         R3      HO2       +O3        =OH        +O2
          sflux(:,3) = sflux(:,3) + RC(:,3)*Y(:,11)*Y(:,3)*DTS*Vol(:)

!         R4      HO2       +HO2       =H2O2
          sflux(:,4) = sflux(:,4) + RC(:,4)*Y(:,11)*Y(:,11)*DTS*Vol(:)

!         R5      HO2       +MeOO      =MeOOH
          sflux(:,5) = sflux(:,5) + RC(:,5)*Y(:,11)*Y(:,18)*DTS*Vol(:)

!         R6      HO2       +MeOO      =HCHO
          sflux(:,6) = sflux(:,6) + RC(:,6)*Y(:,11)*Y(:,18)*DTS*Vol(:)

!         R7      HO2       +EtOO      =EtOOH
          sflux(:,7) = sflux(:,7) + RC(:,7)*Y(:,11)*Y(:,25)*DTS*Vol(:)

!         R8      HO2       +MeCO3     =NULL
          sflux(:,8) = sflux(:,8) + RC(:,8)*Y(:,11)*Y(:,28)*DTS*Vol(:)

!         R9      HO2       +MeCO3     =O3
          sflux(:,9) = sflux(:,9) + RC(:,9)*Y(:,11)*Y(:,28)*DTS*Vol(:)

!         R10     HO2       +MeCO3     =OH + MeOO
          sflux(:,10) = sflux(:,10)                                    &
                      + RC(:,10)*Y(:,11)*Y(:,28)*DTS*Vol(:)
        
!         R11     HO2       +n-PrOO    =n-PrOOH
          sflux(:,11) = sflux(:,11)                                    &
                      + RC(:,11)*Y(:,11)*Y(:,31)*DTS*Vol(:)

!         R12     HO2       +i-PrOO    =i-PrOOH
          sflux(:,12) = sflux(:,12)                                    &
                      + RC(:,12)*Y(:,11)*Y(:,32)*DTS*Vol(:)

!         R13     HO2       +EtCO3     =O2
          sflux(:,13) = sflux(:,13)                                    &
                      + RC(:,13)*Y(:,11)*Y(:,36)*DTS*Vol(:)

!         R14     HO2       +EtCO3     =O3
          sflux(:,14) = sflux(:,14)                                    &
                      + RC(:,14)*Y(:,11)*Y(:,36)*DTS*Vol(:)

!         R15     HO2       +MeCOCH2OO =MeCOCH2OOH
          sflux(:,15) = sflux(:,15)                                    &
                      + RC(:,15)*Y(:,11)*Y(:,38)*DTS*Vol(:)

!         R16     MeOO      +NO        =HO2       +HCHO      +NO2
          sflux(:,16) = sflux(:,16)                                    &
                      + RC(:,16)*Y(:,18)*Y(:,4)*DTS*Vol(:)

!         R17     MeOO      +NO        =MeONO2
          sflux(:,17) = sflux(:,17) + RC(:,17)*Y(:,18)*Y(:,4)*DTS*Vol(:)

!         R18     MeOO      +NO3       =HO2       +HCHO      +NO2
          sflux(:,18) = sflux(:,18) + RC(:,18)*Y(:,18)*y(:,5)*DTS*Vol(:)

!         R19     MeOO      +MeOO      =HCHO
          sflux(:,19) = sflux(:,19)                                    &
                      + RC(:,19)*Y(:,18)*Y(:,18)*DTS*Vol(:)

!         R20     MeOO      +MeOO      =HO2       +HCHO
          sflux(:,20) = sflux(:,20)                                    &
                      + RC(:,20)*Y(:,18)*Y(:,18)*DTS*Vol(:)

!         R21     MeOO      +MeCO3     =HO2       +HCHO      +MeOO
          sflux(:,21) = sflux(:,21)                                    &
                      + RC(:,21)*Y(:,18)*Y(:,28)*DTS*Vol(:)

!         R22     MeOO      +MeCO3     =HCHO
          sflux(:,22) = sflux(:,22)                                    &
                      + RC(:,22)*Y(:,18)*Y(:,28)*DTS*Vol(:)

!         R23     EtOO      +NO        =MeCHO     +HO2       +NO2
          sflux(:,23) = sflux(:,23) + RC(:,23)*Y(:,25)*Y(:,4)*DTS*Vol(:)

!         R24     EtOO      +NO3       =MeCHO     +HO2       +NO2
          sflux(:,24) = sflux(:,24) + RC(:,24)*Y(:,25)*y(:,5)*DTS*Vol(:)

!         R25     EtOO      +MeCO3     =MeCHO     +HO2       +MeOO
          sflux(:,25) = sflux(:,25)                                    &
                      + RC(:,25)*Y(:,25)*Y(:,28)*DTS*Vol(:)

!         R26     MeCO3     +NO        =MeOO      +CO2       +NO2
          sflux(:,26) = sflux(:,26) + RC(:,26)*Y(:,28)*Y(:,4)*DTS*Vol(:)

!         R27     MeCO3     +NO3       =MeOO      +CO2       +NO2
          sflux(:,27) = sflux(:,27) + RC(:,27)*Y(:,28)*Y(:,5)*DTS*Vol(:)

!         R28     n-PrOO    +NO        =EtCHO     +HO2       +NO2
          sflux(:,28) = sflux(:,28) + RC(:,28)*Y(:,31)*Y(:,4)*DTS*Vol(:)

!         R29     n-PrOO    +NO3       =EtCHO     +HO2       +NO2
          sflux(:,29) = sflux(:,29) + RC(:,29)*Y(:,31)*y(:,5)*DTS*Vol(:)

!         R30     i-PrOO    +NO        =Me2CO     +HO2       +NO2
          sflux(:,30) = sflux(:,30) + RC(:,30)*Y(:,32)*Y(:,4)*DTS*Vol(:)

!         R31     i-PrOO    +NO3       =Me2CO     +HO2       +NO2
          sflux(:,31) = sflux(:,31) + RC(:,31)*Y(:,32)*Y(:,5)*DTS*Vol(:)

!         R32     EtCO3     +NO        =EtOO      +CO2       +NO2*Vol(:)
          sflux(:,32) = sflux(:,32) + RC(:,32)*Y(:,36)*Y(:,4)*DTS*Vol(:)

!         R33     EtCO3     +NO3       =EtOO      +CO2       +NO2
          sflux(:,33) = sflux(:,33) + RC(:,33)*Y(:,36)*Y(:,5)*DTS*Vol(:)

!         R34     MeCOCH2OO +NO        =MeCO3     +HCHO      +NO2
          sflux(:,34) = sflux(:,34) + RC(:,34)*Y(:,38)*Y(:,4)*DTS*Vol(:)

!         R35     MeCOCH2OO +NO3       =MeCO3     +HCHO      +NO2
          sflux(:,35) = sflux(:,35) + RC(:,35)*Y(:,38)*Y(:,5)*DTS*Vol(:)

!         R36     NO        +NO3       =NO2
          sflux(:,36) = sflux(:,36) + RC(:,36)*Y(:,4)*Y(:,5)*DTS*Vol(:)

!         R37     NO        +O3        =NO2
          sflux(:,37) = sflux(:,37) + RC(:,37)*Y(:,4)*Y(:,3)*DTS*Vol(:)

!         R38     NO2       +O3        =NO3
          sflux(:,38) = sflux(:,38) + RC(:,38)*Y(:,6)*Y(:,3)*DTS*Vol(:)

!         R39     NO3       +HCHO      =HONO2     +HO2       +CO
          sflux(:,39) = sflux(:,39) + RC(:,39)*Y(:,5)*Y(:,17)*DTS*Vol(:)

!         R40     NO3       +MeCHO     =HONO2     +MeCO3
          sflux(:,40) = sflux(:,40) + RC(:,40)*Y(:,5)*Y(:,27)*DTS*Vol(:)

!         R41     NO3       +EtCHO     =HONO2     +EtCO3
          sflux(:,41) = sflux(:,41) + RC(:,41)*Y(:,5)*Y(:,35)*DTS*Vol(:)

!         R42     NO3       +Me2CO     =HONO2     +MeCOCH2OO
          sflux(:,42) = sflux(:,42) + RC(:,42)*Y(:,5)*Y(:,37)*DTS*Vol(:)

!         R43     N2O5      +H2O       =HONO2
          sflux(:,43) = sflux(:,43) + RC(:,43)*Y(:,7)*H2O(:)*DTS*Vol(:)

!         R44     O(3P)     +O3        =O2
          sflux(:,44) = sflux(:,44) + RC(:,44)*Y(:,1)*Y(:,3)*DTS*Vol(:)

!         R45     O(1D)     +CH4       =OH        +MeOO
          sflux(:,45) = sflux(:,45) + RC(:,45)*Y(:,2)*Y(:,14)*DTS*Vol(:)

!         R46     O(1D)     +CH4       =HCHO      +H2
          sflux(:,46) = sflux(:,46) + RC(:,46)*Y(:,2)*Y(:,14)*DTS*Vol(:)

!         R47     O(1D)     +CH4       =HCHO      +HO2
          sflux(:,47) = sflux(:,47) + RC(:,47)*Y(:,2)*Y(:,14)*DTS*Vol(:)

!         R48     O(1D)     +H2O       =OH
          sflux(:,48) = sflux(:,48) + RC(:,48)*Y(:,2)*H2O(:)*DTS*Vol(:)

!         R49     O(1D)     +N2        =O(3P)     +N2
          sflux(:,49) = sflux(:,49) + RC(:,49)*Y(:,2)*Y(:,23)*DTS*Vol(:)

!         R50     O(1D)     +O2        =O(3P)     +O2
          sflux(:,50) = sflux(:,50) + RC(:,50)*Y(:,2)*Y(:,22)*DTS*Vol(:)

!         R51     OH        +CH4       =H2O       +MeOO
          sflux(:,51) = sflux(:,51)                                    &
                      + RC(:,51)*Y(:,10)*Y(:,14)*DTS*Vol(:)

!         R52     OH        +C2H6      =H2O       +EtOO
          sflux(:,52) = sflux(:,52)                                    &
                      + RC(:,52)*Y(:,10)*Y(:,24)*DTS*Vol(:)

!         R53     OH        +C3H8      =n-PrOO    +H2O
          sflux(:,53) = sflux(:,53)                                    &
                      + RC(:,53)*Y(:,10)*Y(:,30)*DTS*Vol(:)

!         R54     OH        +C3H8      =i-PrOO    +H2O
          sflux(:,54) = sflux(:,54)                                    &
                      + RC(:,54)*Y(:,10)*Y(:,30)*DTS*Vol(:)

!         R55     OH        +CO        =HO2
          sflux(:,55) = sflux(:,55)                                    &
                      + RC(:,55)*Y(:,10)*Y(:,15)*DTS*Vol(:)

!         R56     OH        +EtCHO     =H2O       +EtCO3
          sflux(:,56) = sflux(:,56)                                    &
                      + RC(:,56)*Y(:,10)*Y(:,35)*DTS*Vol(:)

!         R57     OH        +EtOOH     =H2O       +MeCHO     +OH
          sflux(:,57) = sflux(:,57)                                    &
                      + RC(:,57)*Y(:,10)*Y(:,26)*DTS*Vol(:)

!         R58     OH        +EtOOH     =H2O       +EtOO
          sflux(:,58) = sflux(:,58)                                    &
                      + RC(:,58)*Y(:,10)*Y(:,26)*DTS*Vol(:)

!         R59     OH        +H2        =H2O       +HO2
          sflux(:,59) = sflux(:,59)                                    &
                      + RC(:,59)*Y(:,10)*Y(:,12)*DTS*Vol(:)

!         R60     OH        +H2O2      =H2O       +HO2
          sflux(:,60) = sflux(:,60)                                    &
                      + RC(:,60)*Y(:,10)*Y(:,13)*DTS*Vol(:)

!         R61     OH        +HCHO      =H2O       +HO2       +CO
          sflux(:,61) = sflux(:,61)                                    &
                      + RC(:,61)*Y(:,10)*Y(:,17)*DTS*Vol(:)

!         R62     OH        +HO2       =H2O
          sflux(:,62) = sflux(:,62)                                    &
                      + RC(:,62)*Y(:,10)*Y(:,11)*DTS*Vol(:)

!         R63     OH        +HO2NO2    =H2O       +NO2
          sflux(:,63) = sflux(:,63)                                    &
                      + RC(:,63)*Y(:,10)*Y(:,8)*DTS*Vol(:)

!         R64     OH        +HONO2     =H2O       +NO3
          sflux(:,64) = sflux(:,64)                                    &
                      + RC(:,64)*Y(:,10)*Y(:,9)*DTS*Vol(:)

!         R65     OH        +HONO      =H2O       +NO2
          sflux(:,65) = sflux(:,65)                                    &
                      + RC(:,65)*Y(:,10)*Y(:,21)*DTS*Vol(:)

!         R66     OH        +MeOOH     =H2O       +HCHO      +OH
          sflux(:,66) = sflux(:,66)                                    &
                      + RC(:,66)*Y(:,10)*Y(:,20)*DTS*Vol(:)

!         R67     OH        +MeOOH     =H2O       +MeOO
          sflux(:,67) = sflux(:,67)                                    &
                      + RC(:,67)*Y(:,10)*Y(:,20)*DTS*Vol(:)

!         R68     OH        +MeONO2    =HCHO      +NO2       +H2O
          sflux(:,68) = sflux(:,68)                                    &
                      + RC(:,68)*Y(:,10)*Y(:,41)*DTS*Vol(:)

!         R69     OH        +Me2CO     =H2O       +MeCOCH2OO
          sflux(:,69) = sflux(:,69)                                    &
                      + RC(:,69)*Y(:,10)*Y(:,37)*DTS*Vol(:)

!         R70     OH        +Me2CO     =H2O       +MeCOCH2OO
          sflux(:,70) = sflux(:,70)                                    &
                      + RC(:,70)*Y(:,10)*Y(:,37)*DTS*Vol(:)

!         R71     OH        +MeCOCH2OOH=H2O       +MeCOCH2OO
          sflux(:,71) = sflux(:,71)                                    &
                      + RC(:,71)*Y(:,10)*Y(:,39)*DTS*Vol(:)

!         R72     OH        +MeCOCH2OOH=H2O
          sflux(:,72) = sflux(:,72)                                    &
                      + RC(:,72)*Y(:,10)*Y(:,39)*DTS*Vol(:)
        
!         R73     OH        +MeCHO     =H2O       +MeCO3
          sflux(:,73) = sflux(:,73)                                    &
                      + RC(:,73)*Y(:,10)*Y(:,27)*DTS*Vol(:)

!         R74     OH        +NO3       =HO2       +NO2
          sflux(:,74) = sflux(:,74)                                    &
                      + RC(:,74)*Y(:,10)*Y(:,5)*DTS*Vol(:)

!         R75     OH        +O3        =HO2       +O2
          sflux(:,75) = sflux(:,75)                                    &
                      + RC(:,75)*Y(:,10)*Y(:,3)*DTS*Vol(:)

!         R76     OH        +OH        =H2O       +O(3P)
          sflux(:,76) = sflux(:,76)                                    &
                      + RC(:,76)*Y(:,10)*Y(:,10)*DTS*Vol(:)

!         R77     OH        +PAN       =HCHO      +NO2       +H2O
          sflux(:,77) = sflux(:,77)                                    &
                      + RC(:,77)*Y(:,10)*Y(:,29)*DTS*Vol(:)

!         R78     OH        +PPAN      =MeCHO     +NO2       +H2O
          sflux(:,78) = sflux(:,78)                                    &
                      + RC(:,78)*Y(:,10)*Y(:,40)*DTS*Vol(:)

!         R79     OH        +n-PrOOH   =n-PrOO    +H2O
          sflux(:,79) = sflux(:,79)                                    &
                      + RC(:,79)*Y(:,10)*Y(:,33)*DTS*Vol(:)

!         R80     OH        +n-PrOOH   =EtCHO     +H2O       +OH
          sflux(:,80) = sflux(:,80)                                    &
                      + RC(:,80)*Y(:,10)*Y(:,33)*DTS*Vol(:)

!         R81     OH        +i-PrOOH   =i-PrOO    +H2O
          sflux(:,81) = sflux(:,81)                                    &
                      + RC(:,81)*Y(:,10)*Y(:,34)*DTS*Vol(:)

!         R82     OH        +i-PrOOH   =Me2CO     +OH
          sflux(:,82) = sflux(:,82)                                    &
                      + RC(:,82)*Y(:,10)*Y(:,34)*DTS*Vol(:)

!         R83     O3P       +NO2       =NO        +O2
          sflux(:,83) = sflux(:,83) + RC(:,83)*Y(:,1)*Y(:,6)*DTS*Vol(:)

!         R84     HO2S      +O3S       =HO2S      +O2
          sflux(:,84) = sflux(:,84)                                    &
                      + RC(:,84)*Y(:,46)*Y(:,44)*DTS*Vol(:)
        
!         R85     OHS       +O3S       =HO2S      +O2
          sflux(:,85) = sflux(:,85)                                    &
                      + RC(:,85)*Y(:,45)*Y(:,44)*DTS*Vol(:)

!         R86     O(1D)S    +H2O       =H2O
          sflux(:,86) = sflux(:,86)                                    &
                      + RC(:,86)*Y(:,43)*H2O(:)*DTS*Vol(:)

!         R87     O(1D)S    +N2        =O(3P)S    +N2
          sflux(:,87) = sflux(:,87)                                    &
                      + RC(:,87)*Y(:,43)*Y(:,23)*DTS*Vol(:)

!         R88     O(1D)S    +O2        =O(3P)S    +O2
          sflux(:,88) = sflux(:,88)                                    &
                      + RC(:,88)*Y(:,43)*Y(:,22)*DTS*Vol(:)

!         R89     HO2       +HO2       =H2O2      +O2
          sflux(:,89) = sflux(:,89)                                    &
                      + RC(:,89)*Y(:,11)*Y(:,11)*DTS*Vol(:)

!         R90     HO2       +NO2       =HO2NO2
          sflux(:,90) = sflux(:,90)                                    &
                      + RC(:,90)*Y(:,11)*y(:,6)*DTS*Vol(:)

!         R91     HO2NO2    +M         =HO2       +NO2
          sflux(:,91) = sflux(:,91) + RC(:,91)*Y(:,8)*DTS*Vol(:)

!         R92     MeCO3     +NO2       =PAN
          sflux(:,92) = sflux(:,92) + RC(:,92)*Y(:,28)*Y(:,6)*DTS*Vol(:)

!         R93     PAN       +M         =MeCO3     +NO2
          sflux(:,93) = sflux(:,93) + RC(:,93)*Y(:,29)*DTS*Vol(:)

!         R94     N2O5      +M         =NO2       +NO3
          sflux(:,94) = sflux(:,94) + RC(:,94)*Y(:,7)*DTS*Vol(:)

!         R95     NO2       +NO3       =N2O5
          sflux(:,95) = sflux(:,95) + RC(:,95)*Y(:,6)*Y(:,5)*DTS*Vol(:)

!         R96     O(3P)     +O2        =O3
          sflux(:,96) = sflux(:,96) + RC(:,96)*Y(:,1)*Y(:,22)*DTS*Vol(:)

!         R97     OH        +NO        =HONO
          sflux(:,97) = sflux(:,97) + RC(:,97)*Y(:,10)*Y(:,4)*DTS*Vol(:)

!         R98     OH        +NO2       =HONO2
          sflux(:,98) = sflux(:,98) + RC(:,98)*Y(:,10)*Y(:,6)*DTS*Vol(:)

!         R99     OH        +OH        =H2O2
          sflux(:,99) = sflux(:,99)                                    &
                      + RC(:,99)*Y(:,10)*Y(:,10)*DTS*Vol(:)

!         R100    EtCO3     +NO2       =PPAN
          sflux(:,100) = sflux(:,100)                                  &
                       + RC(:,100)*Y(:,36)*Y(:,6)*DTS*Vol(:)

!         R101    PPAN      +M         =EtCO3     +NO2
          sflux(:,101) = sflux(:,101) + RC(:,101)*Y(:,40)*DTS*Vol(:)

!         R102    O(3P)S    +O2        =O3S
          sflux(:,102) = sflux(:,102)                                  &
                       + RC(:,102)*Y(:,42)*Y(:,22)*DTS*Vol(:)

!         --------------------
!         PHOTOLYTIC REACTIONS
!         --------------------

!         EtOOH     =MeCHO     +HO2       +OH
          sflux(:,103)=sflux(:,103)+DJ(:,1)*Y(:,26)*DTS*Vol(:)

!         H2O2      =OH
          sflux(:,104)=sflux(:,104)+DJ(:,2)*Y(:,13)*DTS*Vol(:)

!         HCHO      =HO2       +CO
          sflux(:,105)=sflux(:,105)+DJ(:,3)*Y(:,17)*DTS*Vol(:)

!         HCHO      =H2        +CO
          sflux(:,106)=sflux(:,106)+DJ(:,4)*Y(:,17)*DTS*Vol(:)

!         HO2NO2    =HO2       +NO2
          sflux(:,107)=sflux(:,107)+DJ(:,5)*Y(:,8)*DTS*Vol(:)

!         HONO2     =OH        +NO2
          sflux(:,108)=sflux(:,108)+DJ(:,6)*Y(:,9)*DTS*Vol(:)

!         MeCHO     =MeOO      +HO2       +CO
          sflux(:,109)=sflux(:,109)+DJ(:,7)*Y(:,27)*DTS*Vol(:)

!         MeCHO     =CH4       +CO
          sflux(:,110)=sflux(:,110)+DJ(:,8)*Y(:,27)*DTS*Vol(:)

!         MeOOH     =HO2       +HCHO      +OH
          sflux(:,111)=sflux(:,111)+DJ(:,1)*Y(:,20)*DTS*Vol(:)

!         N2O5      =NO3       +NO2
          sflux(:,112)=sflux(:,112)+DJ(:,9)*Y(:,7)*DTS*Vol(:)

!         NO2       =NO        +O(3P)
          sflux(:,113)=sflux(:,113)+DJ(:,10)*y(:,6)*DTS*Vol(:)

!         NO3       =NO        +O2
          sflux(:,114)=sflux(:,114)+DJ(:,11)*y(:,5)*DTS*Vol(:)

!         NO3       =NO2       +O(3P)
          sflux(:,115)=sflux(:,115)+DJ(:,12)*y(:,5)*DTS*Vol(:)

!         O2        =O(3P)
          sflux(:,116)=sflux(:,116)+DJ(:,13)*Y(:,22)*DTS*Vol(:)

!         O3        =O2        +O(1D)
          sflux(:,117)=sflux(:,117)+DJ(:,14)*Y(:,3)*DTS*Vol(:)

!         O3        =O2        +O(3P)
          sflux(:,118)=sflux(:,118)+DJ(:,15)*Y(:,3)*DTS*Vol(:)

!         PAN       =MeCO3     +NO2
          sflux(:,119)=sflux(:,119)+DJ(:,16)*Y(:,29)*DTS*Vol(:)

!         HONO      =OH        +NO
          sflux(:,120)=sflux(:,120)+DJ(:,17)*Y(:,21)*DTS*Vol(:)

!         EtCHO     =EtOO      +HO2       +CO
          sflux(:,121)=sflux(:,121)+DJ(:,18)*Y(:,35)*DTS*Vol(:)

!         Me2CO     =MeCO3     +MeOO
          sflux(:,122)=sflux(:,122)+DJ(:,19)*Y(:,37)*DTS*Vol(:)

!         n-PrOOH   =EtCHO     +HO2       +OH
          sflux(:,123)=sflux(:,123)+DJ(:,1)*Y(:,33)*DTS*Vol(:)

!         i-PrOOH   =Me2CO     +HO2       +OH
          sflux(:,124)=sflux(:,124)+DJ(:,1)*Y(:,34)*DTS*Vol(:)

!         MeCOCH2OOH=MeCO3     +HCHO      +OH
          sflux(:,125)=sflux(:,125)+DJ(:,1)*Y(:,39)*DTS*Vol(:)

!         PPAN      =EtCO3     +NO2
          sflux(:,126)=sflux(:,126)+DJ(:,16)*Y(:,40)*DTS*Vol(:)

!         MeONO2    =HO2       +HCHO      +NO2
          sflux(:,127)=sflux(:,127)+DJ(:,20)*Y(:,41)*DTS*Vol(:)

!         O3S       =O2        +O(1D)S
          sflux(:,128)=sflux(:,128)+DJ(:,14)*Y(:,44)*DTS*Vol(:)

!         O3S       =O2        +O(3P)S
          sflux(:,129)=sflux(:,129)+DJ(:,15)*Y(:,44)*DTS*Vol(:)


!         --------------------
!         DRY DEPOSITION FLUXES
!         --------------------

          icnt_dd = nr
          DO j=1,jpspec
            IF (ldepd(j)) THEN
              icnt_dd = icnt_dd + 1
              sflux(:,icnt_dd) = sflux(:,icnt_dd) +                    &
                                 ddep(:,j)*y(:,j)*dts*vol(:)
            END IF
          END DO

!         --------------------
!         WET DEPOSITION FLUXES
!         --------------------

          icnt_wd = icnt_dd
          DO j=1,jpspec
            IF (ldepw(j)) THEN
              icnt_wd = icnt_wd + 1
              sflux(:,icnt_wd) = sflux(:,icnt_wd) +                    &
                                 wdep(:,j)*y(:,j)*dts*vol(:) 
            END IF
          END DO      
      
        END IF  ! IF L_ukca_BEflux is true

      END DO  ! n_be_calls
      

!     Convert fluxes from molecules -> moles

      IF (L_ukca_BEflux) THEN
        DO j = 1, ndiags
          sflux(:,j) = sflux(:,j) / avogadro
        END DO
      ENDIF

      RETURN
      END SUBROUTINE UKCA_DERIV
#endif
